(function($){var settings={},roots={},caches={},_consts={className:{BUTTON:"button",LEVEL:"level",ICO_LOADING:"ico_loading",SWITCH:"switch",NAME:"node_name"},event:{NODECREATED:"ztree_nodeCreated",CLICK:"ztree_click",EXPAND:"ztree_expand",COLLAPSE:"ztree_collapse",ASYNC_SUCCESS:"ztree_async_success",ASYNC_ERROR:"ztree_async_error",REMOVE:"ztree_remove",SELECTED:"ztree_selected",UNSELECTED:"ztree_unselected"},id:{A:"_a",ICON:"_ico",SPAN:"_span",SWITCH:"_switch",UL:"_ul"},line:{ROOT:"root",ROOTS:"roots",CENTER:"center",BOTTOM:"bottom",NOLINE:"noline",LINE:"line"},folder:{OPEN:"open",CLOSE:"close",DOCU:"docu"},node:{CURSELECTED:"curSelectedNode"}},_setting={treeId:"",treeObj:null,view:{addDiyDom:null,autoCancelSelected:true,dblClickExpand:true,expandSpeed:"fast",fontCss:{},nameIsHTML:false,selectedMulti:true,showIcon:true,showLine:true,showTitle:true,txtSelectedEnable:false},data:{key:{children:"children",name:"name",title:"",url:"url",icon:"icon"},simpleData:{enable:false,idKey:"id",pIdKey:"pId",rootPId:null},keep:{parent:false,leaf:false}},async:{enable:false,contentType:"application/x-www-form-urlencoded",type:"post",dataType:"text",url:"",autoParam:[],otherParam:[],dataFilter:null},callback:{beforeAsync:null,beforeClick:null,beforeDblClick:null,beforeRightClick:null,beforeMouseDown:null,beforeMouseUp:null,beforeExpand:null,beforeCollapse:null,beforeRemove:null,onAsyncError:null,onAsyncSuccess:null,onNodeCreated:null,onClick:null,onDblClick:null,onRightClick:null,onMouseDown:null,onMouseUp:null,onExpand:null,onCollapse:null,onRemove:null}},_initRoot=function(setting){var r=data.getRoot(setting);if(!r){r={};data.setRoot(setting,r)}r[setting.data.key.children]=[];r.expandTriggerFlag=false;r.curSelectedList=[];r.noSelection=true;r.createdNodes=[];r.zId=0;r._ver=(new Date()).getTime()},_initCache=function(setting){var c=data.getCache(setting);if(!c){c={};data.setCache(setting,c)}c.nodes=[];c.doms=[]},_bindEvent=function(setting){var o=setting.treeObj,c=consts.event;o.bind(c.NODECREATED,function(event,treeId,node){tools.apply(setting.callback.onNodeCreated,[event,treeId,node])});o.bind(c.CLICK,function(event,srcEvent,treeId,node,clickFlag){tools.apply(setting.callback.onClick,[srcEvent,treeId,node,clickFlag])});o.bind(c.EXPAND,function(event,treeId,node){tools.apply(setting.callback.onExpand,[event,treeId,node])});o.bind(c.COLLAPSE,function(event,treeId,node){tools.apply(setting.callback.onCollapse,[event,treeId,node])});o.bind(c.ASYNC_SUCCESS,function(event,treeId,node,msg){tools.apply(setting.callback.onAsyncSuccess,[event,treeId,node,msg])});o.bind(c.ASYNC_ERROR,function(event,treeId,node,XMLHttpRequest,textStatus,errorThrown){tools.apply(setting.callback.onAsyncError,[event,treeId,node,XMLHttpRequest,textStatus,errorThrown])});o.bind(c.REMOVE,function(event,treeId,treeNode){tools.apply(setting.callback.onRemove,[event,treeId,treeNode])});o.bind(c.SELECTED,function(event,treeId,node){tools.apply(setting.callback.onSelected,[treeId,node])});o.bind(c.UNSELECTED,function(event,treeId,node){tools.apply(setting.callback.onUnSelected,[treeId,node])})},_unbindEvent=function(setting){var o=setting.treeObj,c=consts.event;o.unbind(c.NODECREATED).unbind(c.CLICK).unbind(c.EXPAND).unbind(c.COLLAPSE).unbind(c.ASYNC_SUCCESS).unbind(c.ASYNC_ERROR).unbind(c.REMOVE).unbind(c.SELECTED).unbind(c.UNSELECTED)},_eventProxy=function(event){var target=event.target,setting=data.getSetting(event.data.treeId),tId="",node=null,nodeEventType="",treeEventType="",nodeEventCallback=null,treeEventCallback=null,tmp=null;if(tools.eqs(event.type,"mousedown")){treeEventType="mousedown"}else{if(tools.eqs(event.type,"mouseup")){treeEventType="mouseup"}else{if(tools.eqs(event.type,"contextmenu")){treeEventType="contextmenu"}else{if(tools.eqs(event.type,"click")){if(tools.eqs(target.tagName,"span")&&target.getAttribute("treeNode"+consts.id.SWITCH)!==null){tId=tools.getNodeMainDom(target).id;nodeEventType="switchNode"}else{tmp=tools.getMDom(setting,target,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(tmp){tId=tools.getNodeMainDom(tmp).id;nodeEventType="clickNode"}}}else{if(tools.eqs(event.type,"dblclick")){treeEventType="dblclick";tmp=tools.getMDom(setting,target,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(tmp){tId=tools.getNodeMainDom(tmp).id;nodeEventType="switchNode"}}}}}}if(treeEventType.length>0&&tId.length==0){tmp=tools.getMDom(setting,target,[{tagName:"a",attrName:"treeNode"+consts.id.A}]);if(tmp){tId=tools.getNodeMainDom(tmp).id}}if(tId.length>0){node=data.getNodeCache(setting,tId);switch(nodeEventType){case"switchNode":if(!node.isParent){nodeEventType=""}else{if(tools.eqs(event.type,"click")||(tools.eqs(event.type,"dblclick")&&tools.apply(setting.view.dblClickExpand,[setting.treeId,node],setting.view.dblClickExpand))){nodeEventCallback=handler.onSwitchNode}else{nodeEventType=""}}break;case"clickNode":nodeEventCallback=handler.onClickNode;break}}switch(treeEventType){case"mousedown":treeEventCallback=handler.onZTreeMousedown;break;case"mouseup":treeEventCallback=handler.onZTreeMouseup;break;case"dblclick":treeEventCallback=handler.onZTreeDblclick;break;case"contextmenu":treeEventCallback=handler.onZTreeContextmenu;break}var proxyResult={stop:false,node:node,nodeEventType:nodeEventType,nodeEventCallback:nodeEventCallback,treeEventType:treeEventType,treeEventCallback:treeEventCallback};return proxyResult},_initNode=function(setting,level,n,parentNode,isFirstNode,isLastNode,openFlag){if(!n){return}var r=data.getRoot(setting),childKey=setting.data.key.children;n.level=level;n.tId=setting.treeId+"_"+(++r.zId);n.parentTId=parentNode?parentNode.tId:null;n.open=(typeof n.open=="string")?tools.eqs(n.open,"true"):!!n.open;if(n[childKey]&&n[childKey].length>0){n.isParent=true;n.zAsync=true}else{n.isParent=(typeof n.isParent=="string")?tools.eqs(n.isParent,"true"):!!n.isParent;n.open=(n.isParent&&!setting.async.enable)?n.open:false;n.zAsync=!n.isParent}n.isFirstNode=isFirstNode;n.isLastNode=isLastNode;n.getParentNode=function(){return data.getNodeCache(setting,n.parentTId)};n.getPreNode=function(){return data.getPreNode(setting,n)};n.getNextNode=function(){return data.getNextNode(setting,n)};n.getIndex=function(){return data.getNodeIndex(setting,n)};n.getPath=function(){return data.getNodePath(setting,n)};n.isAjaxing=false;data.fixPIdKeyValue(setting,n)},_init={bind:[_bindEvent],unbind:[_unbindEvent],caches:[_initCache],nodes:[_initNode],proxys:[_eventProxy],roots:[_initRoot],beforeA:[],afterA:[],innerBeforeA:[],innerAfterA:[],zTreeTools:[]},data={addNodeCache:function(setting,node){data.getCache(setting).nodes[data.getNodeCacheId(node.tId)]=node},getNodeCacheId:function(tId){return tId.substring(tId.lastIndexOf("_")+1)},addAfterA:function(afterA){_init.afterA.push(afterA)},addBeforeA:function(beforeA){_init.beforeA.push(beforeA)},addInnerAfterA:function(innerAfterA){_init.innerAfterA.push(innerAfterA)},addInnerBeforeA:function(innerBeforeA){_init.innerBeforeA.push(innerBeforeA)},addInitBind:function(bindEvent){_init.bind.push(bindEvent)},addInitUnBind:function(unbindEvent){_init.unbind.push(unbindEvent)},addInitCache:function(initCache){_init.caches.push(initCache)},addInitNode:function(initNode){_init.nodes.push(initNode)},addInitProxy:function(initProxy,isFirst){if(!!isFirst){_init.proxys.splice(0,0,initProxy)}else{_init.proxys.push(initProxy)}},addInitRoot:function(initRoot){_init.roots.push(initRoot)},addNodesData:function(setting,parentNode,index,nodes){var childKey=setting.data.key.children,params;if(!parentNode[childKey]){parentNode[childKey]=[];index=-1}else{if(index>=parentNode[childKey].length){index=-1}}if(parentNode[childKey].length>0&&index===0){parentNode[childKey][0].isFirstNode=false;view.setNodeLineIcos(setting,parentNode[childKey][0])}else{if(parentNode[childKey].length>0&&index<0){parentNode[childKey][parentNode[childKey].length-1].isLastNode=false;view.setNodeLineIcos(setting,parentNode[childKey][parentNode[childKey].length-1])}}parentNode.isParent=true;if(index<0){parentNode[childKey]=parentNode[childKey].concat(nodes)}else{params=[index,0].concat(nodes);parentNode[childKey].splice.apply(parentNode[childKey],params)}},addSelectedNode:function(setting,node){var root=data.getRoot(setting);if(!data.isSelectedNode(setting,node)){root.curSelectedList.push(node)}},addCreatedNode:function(setting,node){if(!!setting.callback.onNodeCreated||!!setting.view.addDiyDom){var root=data.getRoot(setting);root.createdNodes.push(node)}},addZTreeTools:function(zTreeTools){_init.zTreeTools.push(zTreeTools)},exSetting:function(s){$.extend(true,_setting,s)},fixPIdKeyValue:function(setting,node){if(setting.data.simpleData.enable){node[setting.data.simpleData.pIdKey]=node.parentTId?node.getParentNode()[setting.data.simpleData.idKey]:setting.data.simpleData.rootPId}},getAfterA:function(setting,node,array){for(var i=0,j=_init.afterA.length;i<j;i++){_init.afterA[i].apply(this,arguments)}},getBeforeA:function(setting,node,array){for(var i=0,j=_init.beforeA.length;i<j;i++){_init.beforeA[i].apply(this,arguments)}},getInnerAfterA:function(setting,node,array){for(var i=0,j=_init.innerAfterA.length;i<j;i++){_init.innerAfterA[i].apply(this,arguments)}},getInnerBeforeA:function(setting,node,array){for(var i=0,j=_init.innerBeforeA.length;i<j;i++){_init.innerBeforeA[i].apply(this,arguments)}},getCache:function(setting){return caches[setting.treeId]},getNodeIndex:function(setting,node){if(!node){return null}var childKey=setting.data.key.children,p=node.parentTId?node.getParentNode():data.getRoot(setting);for(var i=0,l=p[childKey].length-1;i<=l;i++){if(p[childKey][i]===node){return i}}return -1},getNextNode:function(setting,node){if(!node){return null}var childKey=setting.data.key.children,p=node.parentTId?node.getParentNode():data.getRoot(setting);for(var i=0,l=p[childKey].length-1;i<=l;i++){if(p[childKey][i]===node){return(i==l?null:p[childKey][i+1])}}return null},getNodeByParam:function(setting,nodes,key,value){if(!nodes||!key){return null}var childKey=setting.data.key.children;for(var i=0,l=nodes.length;i<l;i++){if(nodes[i][key]==value){return nodes[i]}var tmp=data.getNodeByParam(setting,nodes[i][childKey],key,value);if(tmp){return tmp}}return null},getNodeCache:function(setting,tId){if(!tId){return null}var n=caches[setting.treeId].nodes[data.getNodeCacheId(tId)];return n?n:null},getNodeName:function(setting,node){var nameKey=setting.data.key.name;return""+node[nameKey]},getNodePath:function(setting,node){if(!node){return null}var path;if(node.parentTId){path=node.getParentNode().getPath()}else{path=[]}if(path){path.push(node)}return path},getNodeTitle:function(setting,node){var t=setting.data.key.title===""?setting.data.key.name:setting.data.key.title;return""+node[t]},getNodes:function(setting){return data.getRoot(setting)[setting.data.key.children]},getNodesByParam:function(setting,nodes,key,value){if(!nodes||!key){return[]}var childKey=setting.data.key.children,result=[];for(var i=0,l=nodes.length;i<l;i++){if(nodes[i][key]==value){result.push(nodes[i])}result=result.concat(data.getNodesByParam(setting,nodes[i][childKey],key,value))}return result},getNodesByParamFuzzy:function(setting,nodes,key,value){if(!nodes||!key){return[]}var childKey=setting.data.key.children,result=[];value=value.toLowerCase();for(var i=0,l=nodes.length;i<l;i++){if(typeof nodes[i][key]=="string"&&nodes[i][key].toLowerCase().indexOf(value)>-1){result.push(nodes[i])}result=result.concat(data.getNodesByParamFuzzy(setting,nodes[i][childKey],key,value))}return result},getNodesByFilter:function(setting,nodes,filter,isSingle,invokeParam){if(!nodes){return(isSingle?null:[])}var childKey=setting.data.key.children,result=isSingle?null:[];for(var i=0,l=nodes.length;i<l;i++){if(tools.apply(filter,[nodes[i],invokeParam],false)){if(isSingle){return nodes[i]}result.push(nodes[i])}var tmpResult=data.getNodesByFilter(setting,nodes[i][childKey],filter,isSingle,invokeParam);if(isSingle&&!!tmpResult){return tmpResult}result=isSingle?tmpResult:result.concat(tmpResult)}return result},getPreNode:function(setting,node){if(!node){return null}var childKey=setting.data.key.children,p=node.parentTId?node.getParentNode():data.getRoot(setting);for(var i=0,l=p[childKey].length;i<l;i++){if(p[childKey][i]===node){return(i==0?null:p[childKey][i-1])}}return null},getRoot:function(setting){return setting?roots[setting.treeId]:null},getRoots:function(){return roots},getSetting:function(treeId){return settings[treeId]},getSettings:function(){return settings},getZTreeTools:function(treeId){var r=this.getRoot(this.getSetting(treeId));return r?r.treeTools:null},initCache:function(setting){for(var i=0,j=_init.caches.length;i<j;i++){_init.caches[i].apply(this,arguments)}},initNode:function(setting,level,node,parentNode,preNode,nextNode){for(var i=0,j=_init.nodes.length;i<j;i++){_init.nodes[i].apply(this,arguments)}},initRoot:function(setting){for(var i=0,j=_init.roots.length;i<j;i++){_init.roots[i].apply(this,arguments)}},isSelectedNode:function(setting,node){var root=data.getRoot(setting);for(var i=0,j=root.curSelectedList.length;i<j;i++){if(node===root.curSelectedList[i]){return true}}return false},removeNodeCache:function(setting,node){var childKey=setting.data.key.children;if(node[childKey]){for(var i=0,l=node[childKey].length;i<l;i++){arguments.callee(setting,node[childKey][i])}}data.getCache(setting).nodes[data.getNodeCacheId(node.tId)]=null},removeSelectedNode:function(setting,node){var root=data.getRoot(setting);for(var i=0,j=root.curSelectedList.length;i<j;i++){if(node===root.curSelectedList[i]||!data.getNodeCache(setting,root.curSelectedList[i].tId)){root.curSelectedList.splice(i,1);setting.treeObj.trigger(consts.event.UNSELECTED,[setting.treeId,node]);i--;j--}}},setCache:function(setting,cache){caches[setting.treeId]=cache},setRoot:function(setting,root){roots[setting.treeId]=root},setZTreeTools:function(setting,zTreeTools){for(var i=0,j=_init.zTreeTools.length;i<j;i++){_init.zTreeTools[i].apply(this,arguments)}},transformToArrayFormat:function(setting,nodes){if(!nodes){return[]}var childKey=setting.data.key.children,r=[];if(tools.isArray(nodes)){for(var i=0,l=nodes.length;i<l;i++){r.push(nodes[i]);if(nodes[i][childKey]){r=r.concat(data.transformToArrayFormat(setting,nodes[i][childKey]))}}}else{r.push(nodes);if(nodes[childKey]){r=r.concat(data.transformToArrayFormat(setting,nodes[childKey]))}}return r},transformTozTreeFormat:function(setting,sNodes){var i,l,key=setting.data.simpleData.idKey,parentKey=setting.data.simpleData.pIdKey,childKey=setting.data.key.children;if(!key||key==""||!sNodes){return[]}if(tools.isArray(sNodes)){var r=[];var tmpMap=[];for(i=0,l=sNodes.length;i<l;i++){tmpMap[sNodes[i][key]]=sNodes[i]}for(i=0,l=sNodes.length;i<l;i++){if(tmpMap[sNodes[i][parentKey]]&&sNodes[i][key]!=sNodes[i][parentKey]){if(!tmpMap[sNodes[i][parentKey]][childKey]){tmpMap[sNodes[i][parentKey]][childKey]=[]}tmpMap[sNodes[i][parentKey]][childKey].push(sNodes[i])}else{r.push(sNodes[i])}}return r}else{return[sNodes]}}},event={bindEvent:function(setting){for(var i=0,j=_init.bind.length;i<j;i++){_init.bind[i].apply(this,arguments)}},unbindEvent:function(setting){for(var i=0,j=_init.unbind.length;i<j;i++){_init.unbind[i].apply(this,arguments)}},bindTree:function(setting){var eventParam={treeId:setting.treeId},o=setting.treeObj;if(!setting.view.txtSelectedEnable){o.bind("selectstart",handler.onSelectStart).css({"-moz-user-select":"-moz-none"})}o.bind("click",eventParam,event.proxy);o.bind("dblclick",eventParam,event.proxy);o.bind("mouseover",eventParam,event.proxy);o.bind("mouseout",eventParam,event.proxy);o.bind("mousedown",eventParam,event.proxy);o.bind("mouseup",eventParam,event.proxy);o.bind("contextmenu",eventParam,event.proxy)},unbindTree:function(setting){var o=setting.treeObj;o.unbind("selectstart",handler.onSelectStart).unbind("click",event.proxy).unbind("dblclick",event.proxy).unbind("mouseover",event.proxy).unbind("mouseout",event.proxy).unbind("mousedown",event.proxy).unbind("mouseup",event.proxy).unbind("contextmenu",event.proxy)},doProxy:function(e){var results=[];for(var i=0,j=_init.proxys.length;i<j;i++){var proxyResult=_init.proxys[i].apply(this,arguments);results.push(proxyResult);if(proxyResult.stop){break}}return results},proxy:function(e){var setting=data.getSetting(e.data.treeId);if(!tools.uCanDo(setting,e)){return true}var results=event.doProxy(e),r=true,x=false;for(var i=0,l=results.length;i<l;i++){var proxyResult=results[i];if(proxyResult.nodeEventCallback){x=true;r=proxyResult.nodeEventCallback.apply(proxyResult,[e,proxyResult.node])&&r}if(proxyResult.treeEventCallback){x=true;r=proxyResult.treeEventCallback.apply(proxyResult,[e,proxyResult.node])&&r}}return r}},handler={onSwitchNode:function(event,node){var setting=data.getSetting(event.data.treeId);if(node.open){if(tools.apply(setting.callback.beforeCollapse,[setting.treeId,node],true)==false){return true}data.getRoot(setting).expandTriggerFlag=true;view.switchNode(setting,node)}else{if(tools.apply(setting.callback.beforeExpand,[setting.treeId,node],true)==false){return true}data.getRoot(setting).expandTriggerFlag=true;view.switchNode(setting,node)}return true},onClickNode:function(event,node){var setting=data.getSetting(event.data.treeId),clickFlag=((setting.view.autoCancelSelected&&(event.ctrlKey||event.metaKey))&&data.isSelectedNode(setting,node))?0:(setting.view.autoCancelSelected&&(event.ctrlKey||event.metaKey)&&setting.view.selectedMulti)?2:1;if(tools.apply(setting.callback.beforeClick,[setting.treeId,node,clickFlag],true)==false){return true}if(clickFlag===0){view.cancelPreSelectedNode(setting,node)}else{view.selectNode(setting,node,clickFlag===2)}setting.treeObj.trigger(consts.event.CLICK,[event,setting.treeId,node,clickFlag]);return true},onZTreeMousedown:function(event,node){var setting=data.getSetting(event.data.treeId);if(tools.apply(setting.callback.beforeMouseDown,[setting.treeId,node],true)){tools.apply(setting.callback.onMouseDown,[event,setting.treeId,node])}return true},onZTreeMouseup:function(event,node){var setting=data.getSetting(event.data.treeId);if(tools.apply(setting.callback.beforeMouseUp,[setting.treeId,node],true)){tools.apply(setting.callback.onMouseUp,[event,setting.treeId,node])}return true},onZTreeDblclick:function(event,node){var setting=data.getSetting(event.data.treeId);if(tools.apply(setting.callback.beforeDblClick,[setting.treeId,node],true)){tools.apply(setting.callback.onDblClick,[event,setting.treeId,node])}return true},onZTreeContextmenu:function(event,node){var setting=data.getSetting(event.data.treeId);if(tools.apply(setting.callback.beforeRightClick,[setting.treeId,node],true)){tools.apply(setting.callback.onRightClick,[event,setting.treeId,node])}return(typeof setting.callback.onRightClick)!="function"},onSelectStart:function(e){var n=e.originalEvent.srcElement.nodeName.toLowerCase();return(n==="input"||n==="textarea")}},tools={apply:function(fun,param,defaultValue){if((typeof fun)=="function"){return fun.apply(zt,param?param:[])}return defaultValue},canAsync:function(setting,node){var childKey=setting.data.key.children;return(setting.async.enable&&node&&node.isParent&&!(node.zAsync||(node[childKey]&&node[childKey].length>0)))},clone:function(obj){if(obj===null){return null}var o=tools.isArray(obj)?[]:{};for(var i in obj){o[i]=(obj[i] instanceof Date)?new Date(obj[i].getTime()):(typeof obj[i]==="object"?arguments.callee(obj[i]):obj[i])}return o},eqs:function(str1,str2){return str1.toLowerCase()===str2.toLowerCase()},isArray:function(arr){return Object.prototype.toString.apply(arr)==="[object Array]"},$:function(node,exp,setting){if(!!exp&&typeof exp!="string"){setting=exp;exp=""}if(typeof node=="string"){return $(node,setting?setting.treeObj.get(0).ownerDocument:null)}else{return $("#"+node.tId+exp,setting?setting.treeObj:null)}},getMDom:function(setting,curDom,targetExpr){if(!curDom){return null}while(curDom&&curDom.id!==setting.treeId){for(var i=0,l=targetExpr.length;curDom.tagName&&i<l;i++){if(tools.eqs(curDom.tagName,targetExpr[i].tagName)&&curDom.getAttribute(targetExpr[i].attrName)!==null){return curDom}}curDom=curDom.parentNode}return null},getNodeMainDom:function(target){return($(target).parent("li").get(0)||$(target).parentsUntil("li").parent().get(0))},isChildOrSelf:function(dom,parentId){return($(dom).closest("#"+parentId).length>0)},uCanDo:function(setting,e){return true}},view={addNodes:function(setting,parentNode,index,newNodes,isSilent){if(setting.data.keep.leaf&&parentNode&&!parentNode.isParent){return}if(!tools.isArray(newNodes)){newNodes=[newNodes]}if(setting.data.simpleData.enable){newNodes=data.transformTozTreeFormat(setting,newNodes)}if(parentNode){var target_switchObj=$$(parentNode,consts.id.SWITCH,setting),target_icoObj=$$(parentNode,consts.id.ICON,setting),target_ulObj=$$(parentNode,consts.id.UL,setting);if(!parentNode.open){view.replaceSwitchClass(parentNode,target_switchObj,consts.folder.CLOSE);view.replaceIcoClass(parentNode,target_icoObj,consts.folder.CLOSE);parentNode.open=false;target_ulObj.css({display:"none"})}data.addNodesData(setting,parentNode,index,newNodes);view.createNodes(setting,parentNode.level+1,newNodes,parentNode,index);if(!isSilent){view.expandCollapseParentNode(setting,parentNode,true)}}else{data.addNodesData(setting,data.getRoot(setting),index,newNodes);view.createNodes(setting,0,newNodes,null,index)}},appendNodes:function(setting,level,nodes,parentNode,index,initFlag,openFlag){if(!nodes){return[]}var html=[],childKey=setting.data.key.children;var tmpPNode=(parentNode)?parentNode:data.getRoot(setting),tmpPChild=tmpPNode[childKey],isFirstNode,isLastNode;if(!tmpPChild||index>=tmpPChild.length){index=-1}for(var i=0,l=nodes.length;i<l;i++){var node=nodes[i];if(initFlag){isFirstNode=((index===0||tmpPChild.length==nodes.length)&&(i==0));isLastNode=(index<0&&i==(nodes.length-1));data.initNode(setting,level,node,parentNode,isFirstNode,isLastNode,openFlag);data.addNodeCache(setting,node)}var childHtml=[];if(node[childKey]&&node[childKey].length>0){childHtml=view.appendNodes(setting,level+1,node[childKey],node,-1,initFlag,openFlag&&node.open)}if(openFlag){view.makeDOMNodeMainBefore(html,setting,node);view.makeDOMNodeLine(html,setting,node);data.getBeforeA(setting,node,html);view.makeDOMNodeNameBefore(html,setting,node);data.getInnerBeforeA(setting,node,html);view.makeDOMNodeIcon(html,setting,node);data.getInnerAfterA(setting,node,html);view.makeDOMNodeNameAfter(html,setting,node);data.getAfterA(setting,node,html);if(node.isParent&&node.open){view.makeUlHtml(setting,node,html,childHtml.join(""))}view.makeDOMNodeMainAfter(html,setting,node);data.addCreatedNode(setting,node)}}return html},appendParentULDom:function(setting,node){var html=[],nObj=$$(node,setting);if(!nObj.get(0)&&!!node.parentTId){view.appendParentULDom(setting,node.getParentNode());nObj=$$(node,setting)}var ulObj=$$(node,consts.id.UL,setting);if(ulObj.get(0)){ulObj.remove()}var childKey=setting.data.key.children,childHtml=view.appendNodes(setting,node.level+1,node[childKey],node,-1,false,true);view.makeUlHtml(setting,node,html,childHtml.join(""));nObj.append(html.join(""))},asyncNode:function(setting,node,isSilent,callback){var i,l;if(node&&!node.isParent){tools.apply(callback);return false}else{if(node&&node.isAjaxing){return false}else{if(tools.apply(setting.callback.beforeAsync,[setting.treeId,node],true)==false){tools.apply(callback);return false}}}if(node){node.isAjaxing=true;var icoObj=$$(node,consts.id.ICON,setting);icoObj.attr({style:"","class":consts.className.BUTTON+" "+consts.className.ICO_LOADING})}var tmpParam={};for(i=0,l=setting.async.autoParam.length;node&&i<l;i++){var pKey=setting.async.autoParam[i].split("="),spKey=pKey;if(pKey.length>1){spKey=pKey[1];pKey=pKey[0]}tmpParam[spKey]=node[pKey]}if(tools.isArray(setting.async.otherParam)){for(i=0,l=setting.async.otherParam.length;i<l;i+=2){tmpParam[setting.async.otherParam[i]]=setting.async.otherParam[i+1]}}else{for(var p in setting.async.otherParam){tmpParam[p]=setting.async.otherParam[p]}}var _tmpV=data.getRoot(setting)._ver;$.ajax({contentType:setting.async.contentType,cache:false,type:setting.async.type,url:tools.apply(setting.async.url,[setting.treeId,node],setting.async.url),data:tmpParam,dataType:setting.async.dataType,success:function(msg){if(_tmpV!=data.getRoot(setting)._ver){return}var newNodes=[];try{if(!msg||msg.length==0){newNodes=[]}else{if(typeof msg=="string"){newNodes=eval("("+msg+")")}else{newNodes=msg}}}catch(err){newNodes=msg}if(node){node.isAjaxing=null;node.zAsync=true}view.setNodeLineIcos(setting,node);if(newNodes&&newNodes!==""){newNodes=tools.apply(setting.async.dataFilter,[setting.treeId,node,newNodes],newNodes);view.addNodes(setting,node,-1,!!newNodes?tools.clone(newNodes):[],!!isSilent)}else{view.addNodes(setting,node,-1,[],!!isSilent)}setting.treeObj.trigger(consts.event.ASYNC_SUCCESS,[setting.treeId,node,msg]);tools.apply(callback)},error:function(XMLHttpRequest,textStatus,errorThrown){if(_tmpV!=data.getRoot(setting)._ver){return}if(node){node.isAjaxing=null}view.setNodeLineIcos(setting,node);setting.treeObj.trigger(consts.event.ASYNC_ERROR,[setting.treeId,node,XMLHttpRequest,textStatus,errorThrown])}});return true},cancelPreSelectedNode:function(setting,node,excludeNode){var list=data.getRoot(setting).curSelectedList,i,n;for(i=list.length-1;i>=0;i--){n=list[i];if(node===n||(!node&&(!excludeNode||excludeNode!==n))){$$(n,consts.id.A,setting).removeClass(consts.node.CURSELECTED);if(node){data.removeSelectedNode(setting,node);break}else{list.splice(i,1);setting.treeObj.trigger(consts.event.UNSELECTED,[setting.treeId,n])}}}},createNodeCallback:function(setting){if(!!setting.callback.onNodeCreated||!!setting.view.addDiyDom){var root=data.getRoot(setting);while(root.createdNodes.length>0){var node=root.createdNodes.shift();tools.apply(setting.view.addDiyDom,[setting.treeId,node]);if(!!setting.callback.onNodeCreated){setting.treeObj.trigger(consts.event.NODECREATED,[setting.treeId,node])}}}},createNodes:function(setting,level,nodes,parentNode,index){if(!nodes||nodes.length==0){return}var root=data.getRoot(setting),childKey=setting.data.key.children,openFlag=!parentNode||parentNode.open||!!$$(parentNode[childKey][0],setting).get(0);root.createdNodes=[];var zTreeHtml=view.appendNodes(setting,level,nodes,parentNode,index,true,openFlag),parentObj,nextObj;if(!parentNode){parentObj=setting.treeObj}else{var ulObj=$$(parentNode,consts.id.UL,setting);if(ulObj.get(0)){parentObj=ulObj}}if(parentObj){if(index>=0){nextObj=parentObj.children()[index]}if(index>=0&&nextObj){$(nextObj).before(zTreeHtml.join(""))}else{parentObj.append(zTreeHtml.join(""))}}view.createNodeCallback(setting)},destroy:function(setting){if(!setting){return}data.initCache(setting);data.initRoot(setting);event.unbindTree(setting);event.unbindEvent(setting);setting.treeObj.empty();delete settings[setting.treeId]},expandCollapseNode:function(setting,node,expandFlag,animateFlag,callback){var root=data.getRoot(setting),childKey=setting.data.key.children;if(!node){tools.apply(callback,[]);return}if(root.expandTriggerFlag){var _callback=callback;callback=function(){if(_callback){_callback()}if(node.open){setting.treeObj.trigger(consts.event.EXPAND,[setting.treeId,node])}else{setting.treeObj.trigger(consts.event.COLLAPSE,[setting.treeId,node])}};root.expandTriggerFlag=false}if(!node.open&&node.isParent&&((!$$(node,consts.id.UL,setting).get(0))||(node[childKey]&&node[childKey].length>0&&!$$(node[childKey][0],setting).get(0)))){view.appendParentULDom(setting,node);view.createNodeCallback(setting)}if(node.open==expandFlag){tools.apply(callback,[]);return}var ulObj=$$(node,consts.id.UL,setting),switchObj=$$(node,consts.id.SWITCH,setting),icoObj=$$(node,consts.id.ICON,setting);if(node.isParent){node.open=!node.open;if(node.iconOpen&&node.iconClose){icoObj.attr("style",view.makeNodeIcoStyle(setting,node))}if(node.open){view.replaceSwitchClass(node,switchObj,consts.folder.OPEN);view.replaceIcoClass(node,icoObj,consts.folder.OPEN);if(animateFlag==false||setting.view.expandSpeed==""){ulObj.show();tools.apply(callback,[])}else{if(node[childKey]&&node[childKey].length>0){ulObj.slideDown(setting.view.expandSpeed,callback)}else{ulObj.show();tools.apply(callback,[])}}}else{view.replaceSwitchClass(node,switchObj,consts.folder.CLOSE);view.replaceIcoClass(node,icoObj,consts.folder.CLOSE);if(animateFlag==false||setting.view.expandSpeed==""||!(node[childKey]&&node[childKey].length>0)){ulObj.hide();tools.apply(callback,[])}else{ulObj.slideUp(setting.view.expandSpeed,callback)}}}else{tools.apply(callback,[])}},expandCollapseParentNode:function(setting,node,expandFlag,animateFlag,callback){if(!node){return}if(!node.parentTId){view.expandCollapseNode(setting,node,expandFlag,animateFlag,callback);return}else{view.expandCollapseNode(setting,node,expandFlag,animateFlag)}if(node.parentTId){view.expandCollapseParentNode(setting,node.getParentNode(),expandFlag,animateFlag,callback)}},expandCollapseSonNode:function(setting,node,expandFlag,animateFlag,callback){var root=data.getRoot(setting),childKey=setting.data.key.children,treeNodes=(node)?node[childKey]:root[childKey],selfAnimateSign=(node)?false:animateFlag,expandTriggerFlag=data.getRoot(setting).expandTriggerFlag;data.getRoot(setting).expandTriggerFlag=false;if(treeNodes){for(var i=0,l=treeNodes.length;i<l;i++){if(treeNodes[i]){view.expandCollapseSonNode(setting,treeNodes[i],expandFlag,selfAnimateSign)}}}data.getRoot(setting).expandTriggerFlag=expandTriggerFlag;view.expandCollapseNode(setting,node,expandFlag,animateFlag,callback)},isSelectedNode:function(setting,node){if(!node){return false}var list=data.getRoot(setting).curSelectedList,i;for(i=list.length-1;i>=0;i--){if(node===list[i]){return true}}return false},makeDOMNodeIcon:function(html,setting,node){var nameStr=data.getNodeName(setting,node),name=setting.view.nameIsHTML?nameStr:nameStr.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");html.push("<span id='",node.tId,consts.id.ICON,"' title='' treeNode",consts.id.ICON," class='",view.makeNodeIcoClass(setting,node),"' style='",view.makeNodeIcoStyle(setting,node),"'></span><span id='",node.tId,consts.id.SPAN,"' class='",consts.className.NAME,"'>",name,"</span>")},makeDOMNodeLine:function(html,setting,node){html.push("<span id='",node.tId,consts.id.SWITCH,"' title='' class='",view.makeNodeLineClass(setting,node),"' treeNode",consts.id.SWITCH,"></span>")},makeDOMNodeMainAfter:function(html,setting,node){html.push("</li>")},makeDOMNodeMainBefore:function(html,setting,node){html.push("<li id='",node.tId,"' class='",consts.className.LEVEL,node.level,"' tabindex='0' hidefocus='true' treenode>")},makeDOMNodeNameAfter:function(html,setting,node){html.push("</a>")},makeDOMNodeNameBefore:function(html,setting,node){var title=data.getNodeTitle(setting,node),url=view.makeNodeUrl(setting,node),fontcss=view.makeNodeFontCss(setting,node),fontStyle=[];for(var f in fontcss){fontStyle.push(f,":",fontcss[f],";")}html.push("<a id='",node.tId,consts.id.A,"' class='",consts.className.LEVEL,node.level,"' treeNode",consts.id.A,' onclick="',(node.click||""),'" ',((url!=null&&url.length>0)?"href='"+url+"'":"")," target='",view.makeNodeTarget(node),"' style='",fontStyle.join(""),"'");if(tools.apply(setting.view.showTitle,[setting.treeId,node],setting.view.showTitle)&&title){html.push("title='",title.replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),"'")}html.push(">")},makeNodeFontCss:function(setting,node){var fontCss=tools.apply(setting.view.fontCss,[setting.treeId,node],setting.view.fontCss);return(fontCss&&((typeof fontCss)!="function"))?fontCss:{}},makeNodeIcoClass:function(setting,node){var icoCss=["ico"];if(!node.isAjaxing){icoCss[0]=(node.iconSkin?node.iconSkin+"_":"")+icoCss[0];if(node.isParent){icoCss.push(node.open?consts.folder.OPEN:consts.folder.CLOSE)}else{icoCss.push(consts.folder.DOCU)}}return consts.className.BUTTON+" "+icoCss.join("_")},makeNodeIcoStyle:function(setting,node){var icoStyle=[];if(!node.isAjaxing){var icon=(node.isParent&&node.iconOpen&&node.iconClose)?(node.open?node.iconOpen:node.iconClose):node[setting.data.key.icon];if(icon){icoStyle.push("background:url(",icon,") 0 0 no-repeat;")}if(setting.view.showIcon==false||!tools.apply(setting.view.showIcon,[setting.treeId,node],true)){icoStyle.push("width:0px;height:0px;")}}return icoStyle.join("")},makeNodeLineClass:function(setting,node){var lineClass=[];if(setting.view.showLine){if(node.level==0&&node.isFirstNode&&node.isLastNode){lineClass.push(consts.line.ROOT)}else{if(node.level==0&&node.isFirstNode){lineClass.push(consts.line.ROOTS)}else{if(node.isLastNode){lineClass.push(consts.line.BOTTOM)}else{lineClass.push(consts.line.CENTER)}}}}else{lineClass.push(consts.line.NOLINE)}if(node.isParent){lineClass.push(node.open?consts.folder.OPEN:consts.folder.CLOSE)}else{lineClass.push(consts.folder.DOCU)}return view.makeNodeLineClassEx(node)+lineClass.join("_")},makeNodeLineClassEx:function(node){return consts.className.BUTTON+" "+consts.className.LEVEL+node.level+" "+consts.className.SWITCH+" "},makeNodeTarget:function(node){return(node.target||"_blank")},makeNodeUrl:function(setting,node){var urlKey=setting.data.key.url;return node[urlKey]?node[urlKey]:null},makeUlHtml:function(setting,node,html,content){html.push("<ul id='",node.tId,consts.id.UL,"' class='",consts.className.LEVEL,node.level," ",view.makeUlLineClass(setting,node),"' style='display:",(node.open?"block":"none"),"'>");html.push(content);html.push("</ul>")},makeUlLineClass:function(setting,node){return((setting.view.showLine&&!node.isLastNode)?consts.line.LINE:"")},removeChildNodes:function(setting,node){if(!node){return}var childKey=setting.data.key.children,nodes=node[childKey];if(!nodes){return}for(var i=0,l=nodes.length;i<l;i++){data.removeNodeCache(setting,nodes[i])}data.removeSelectedNode(setting);delete node[childKey];if(!setting.data.keep.parent){node.isParent=false;node.open=false;var tmp_switchObj=$$(node,consts.id.SWITCH,setting),tmp_icoObj=$$(node,consts.id.ICON,setting);view.replaceSwitchClass(node,tmp_switchObj,consts.folder.DOCU);view.replaceIcoClass(node,tmp_icoObj,consts.folder.DOCU);$$(node,consts.id.UL,setting).remove()}else{$$(node,consts.id.UL,setting).empty()}},setFirstNode:function(setting,parentNode){var childKey=setting.data.key.children,childLength=parentNode[childKey].length;if(childLength>0){parentNode[childKey][0].isFirstNode=true}},setLastNode:function(setting,parentNode){var childKey=setting.data.key.children,childLength=parentNode[childKey].length;if(childLength>0){parentNode[childKey][childLength-1].isLastNode=true}},removeNode:function(setting,node){var root=data.getRoot(setting),childKey=setting.data.key.children,parentNode=(node.parentTId)?node.getParentNode():root;node.isFirstNode=false;node.isLastNode=false;node.getPreNode=function(){return null};node.getNextNode=function(){return null};if(!data.getNodeCache(setting,node.tId)){return}$$(node,setting).remove();data.removeNodeCache(setting,node);data.removeSelectedNode(setting,node);for(var i=0,l=parentNode[childKey].length;i<l;i++){if(parentNode[childKey][i].tId==node.tId){parentNode[childKey].splice(i,1);break}}view.setFirstNode(setting,parentNode);view.setLastNode(setting,parentNode);var tmp_ulObj,tmp_switchObj,tmp_icoObj,childLength=parentNode[childKey].length;if(!setting.data.keep.parent&&childLength==0){parentNode.isParent=false;parentNode.open=false;tmp_ulObj=$$(parentNode,consts.id.UL,setting);tmp_switchObj=$$(parentNode,consts.id.SWITCH,setting);tmp_icoObj=$$(parentNode,consts.id.ICON,setting);view.replaceSwitchClass(parentNode,tmp_switchObj,consts.folder.DOCU);view.replaceIcoClass(parentNode,tmp_icoObj,consts.folder.DOCU);tmp_ulObj.css("display","none")}else{if(setting.view.showLine&&childLength>0){var newLast=parentNode[childKey][childLength-1];tmp_ulObj=$$(newLast,consts.id.UL,setting);tmp_switchObj=$$(newLast,consts.id.SWITCH,setting);tmp_icoObj=$$(newLast,consts.id.ICON,setting);if(parentNode==root){if(parentNode[childKey].length==1){view.replaceSwitchClass(newLast,tmp_switchObj,consts.line.ROOT)}else{var tmp_first_switchObj=$$(parentNode[childKey][0],consts.id.SWITCH,setting);view.replaceSwitchClass(parentNode[childKey][0],tmp_first_switchObj,consts.line.ROOTS);view.replaceSwitchClass(newLast,tmp_switchObj,consts.line.BOTTOM)}}else{view.replaceSwitchClass(newLast,tmp_switchObj,consts.line.BOTTOM)}tmp_ulObj.removeClass(consts.line.LINE)}}},replaceIcoClass:function(node,obj,newName){if(!obj||node.isAjaxing){return}var tmpName=obj.attr("class");if(tmpName==undefined){return}var tmpList=tmpName.split("_");switch(newName){case consts.folder.OPEN:case consts.folder.CLOSE:case consts.folder.DOCU:tmpList[tmpList.length-1]=newName;break}obj.attr("class",tmpList.join("_"))},replaceSwitchClass:function(node,obj,newName){if(!obj){return}var tmpName=obj.attr("class");if(tmpName==undefined){return}var tmpList=tmpName.split("_");switch(newName){case consts.line.ROOT:case consts.line.ROOTS:case consts.line.CENTER:case consts.line.BOTTOM:case consts.line.NOLINE:tmpList[0]=view.makeNodeLineClassEx(node)+newName;break;case consts.folder.OPEN:case consts.folder.CLOSE:case consts.folder.DOCU:tmpList[1]=newName;break}obj.attr("class",tmpList.join("_"));if(newName!==consts.folder.DOCU){obj.removeAttr("disabled")}else{obj.attr("disabled","disabled")}},selectNode:function(setting,node,addFlag){if(!addFlag){view.cancelPreSelectedNode(setting,null,node)}$$(node,consts.id.A,setting).addClass(consts.node.CURSELECTED);data.addSelectedNode(setting,node);setting.treeObj.trigger(consts.event.SELECTED,[setting.treeId,node])},setNodeFontCss:function(setting,treeNode){var aObj=$$(treeNode,consts.id.A,setting),fontCss=view.makeNodeFontCss(setting,treeNode);if(fontCss){aObj.css(fontCss)}},setNodeLineIcos:function(setting,node){if(!node){return}var switchObj=$$(node,consts.id.SWITCH,setting),ulObj=$$(node,consts.id.UL,setting),icoObj=$$(node,consts.id.ICON,setting),ulLine=view.makeUlLineClass(setting,node);if(ulLine.length==0){ulObj.removeClass(consts.line.LINE)}else{ulObj.addClass(ulLine)}switchObj.attr("class",view.makeNodeLineClass(setting,node));if(node.isParent){switchObj.removeAttr("disabled")}else{switchObj.attr("disabled","disabled")}icoObj.removeAttr("style");icoObj.attr("style",view.makeNodeIcoStyle(setting,node));icoObj.attr("class",view.makeNodeIcoClass(setting,node))},setNodeName:function(setting,node){var title=data.getNodeTitle(setting,node),nObj=$$(node,consts.id.SPAN,setting);nObj.empty();if(setting.view.nameIsHTML){nObj.html(data.getNodeName(setting,node))}else{nObj.text(data.getNodeName(setting,node))}if(tools.apply(setting.view.showTitle,[setting.treeId,node],setting.view.showTitle)){var aObj=$$(node,consts.id.A,setting);aObj.attr("title",!title?"":title)}},setNodeTarget:function(setting,node){var aObj=$$(node,consts.id.A,setting);aObj.attr("target",view.makeNodeTarget(node))},setNodeUrl:function(setting,node){var aObj=$$(node,consts.id.A,setting),url=view.makeNodeUrl(setting,node);if(url==null||url.length==0){aObj.removeAttr("href")}else{aObj.attr("href",url)}},switchNode:function(setting,node){if(node.open||!tools.canAsync(setting,node)){view.expandCollapseNode(setting,node,!node.open)}else{if(setting.async.enable){if(!view.asyncNode(setting,node)){view.expandCollapseNode(setting,node,!node.open);return}}else{if(node){view.expandCollapseNode(setting,node,!node.open)}}}}};$.fn.zTree={consts:_consts,_z:{tools:tools,view:view,event:event,data:data},getZTreeObj:function(treeId){var o=data.getZTreeTools(treeId);return o?o:null},destroy:function(treeId){if(!!treeId&&treeId.length>0){view.destroy(data.getSetting(treeId))}else{for(var s in settings){view.destroy(settings[s])}}},init:function(obj,zSetting,zNodes){var setting=tools.clone(_setting);$.extend(true,setting,zSetting);setting.treeId=obj.attr("id");setting.treeObj=obj;setting.treeObj.empty();settings[setting.treeId]=setting;if(typeof document.body.style.maxHeight==="undefined"){setting.view.expandSpeed=""}data.initRoot(setting);var root=data.getRoot(setting),childKey=setting.data.key.children;zNodes=zNodes?tools.clone(tools.isArray(zNodes)?zNodes:[zNodes]):[];if(setting.data.simpleData.enable){root[childKey]=data.transformTozTreeFormat(setting,zNodes)}else{root[childKey]=zNodes}data.initCache(setting);event.unbindTree(setting);event.bindTree(setting);event.unbindEvent(setting);event.bindEvent(setting);var zTreeTools={setting:setting,addNodes:function(parentNode,index,newNodes,isSilent){if(!parentNode){parentNode=null}if(parentNode&&!parentNode.isParent&&setting.data.keep.leaf){return null}var i=parseInt(index,10);if(isNaN(i)){isSilent=!!newNodes;newNodes=index;index=-1}else{index=i}if(!newNodes){return null}var xNewNodes=tools.clone(tools.isArray(newNodes)?newNodes:[newNodes]);function addCallback(){view.addNodes(setting,parentNode,index,xNewNodes,(isSilent==true))}if(tools.canAsync(setting,parentNode)){view.asyncNode(setting,parentNode,isSilent,addCallback)}else{addCallback()}return xNewNodes},cancelSelectedNode:function(node){view.cancelPreSelectedNode(setting,node)},destroy:function(){view.destroy(setting)},expandAll:function(expandFlag){expandFlag=!!expandFlag;view.expandCollapseSonNode(setting,null,expandFlag,true);return expandFlag},expandNode:function(node,expandFlag,sonSign,focus,callbackFlag){if(!node||!node.isParent){return null}if(expandFlag!==true&&expandFlag!==false){expandFlag=!node.open}callbackFlag=!!callbackFlag;if(callbackFlag&&expandFlag&&(tools.apply(setting.callback.beforeExpand,[setting.treeId,node],true)==false)){return null}else{if(callbackFlag&&!expandFlag&&(tools.apply(setting.callback.beforeCollapse,[setting.treeId,node],true)==false)){return null}}if(expandFlag&&node.parentTId){view.expandCollapseParentNode(setting,node.getParentNode(),expandFlag,false)}if(expandFlag===node.open&&!sonSign){return null}data.getRoot(setting).expandTriggerFlag=callbackFlag;if(!tools.canAsync(setting,node)&&sonSign){view.expandCollapseSonNode(setting,node,expandFlag,true,showNodeFocus)}else{node.open=!expandFlag;view.switchNode(this.setting,node);showNodeFocus()}return expandFlag;function showNodeFocus(){var a=$$(node,setting).get(0);if(a&&focus!==false){if(a.scrollIntoView){a.scrollIntoView(false)}else{try{a.focus().blur()}catch(e){}}}}},getNodes:function(){return data.getNodes(setting)},getNodeByParam:function(key,value,parentNode){if(!key){return null}return data.getNodeByParam(setting,parentNode?parentNode[setting.data.key.children]:data.getNodes(setting),key,value)},getNodeByTId:function(tId){return data.getNodeCache(setting,tId)},getNodesByParam:function(key,value,parentNode){if(!key){return null}return data.getNodesByParam(setting,parentNode?parentNode[setting.data.key.children]:data.getNodes(setting),key,value)},getNodesByParamFuzzy:function(key,value,parentNode){if(!key){return null}return data.getNodesByParamFuzzy(setting,parentNode?parentNode[setting.data.key.children]:data.getNodes(setting),key,value)},getNodesByFilter:function(filter,isSingle,parentNode,invokeParam){isSingle=!!isSingle;if(!filter||(typeof filter!="function")){return(isSingle?null:[])}return data.getNodesByFilter(setting,parentNode?parentNode[setting.data.key.children]:data.getNodes(setting),filter,isSingle,invokeParam)},getNodeIndex:function(node){if(!node){return null}var childKey=setting.data.key.children,parentNode=(node.parentTId)?node.getParentNode():data.getRoot(setting);for(var i=0,l=parentNode[childKey].length;i<l;i++){if(parentNode[childKey][i]==node){return i}}return -1},getSelectedNodes:function(){var r=[],list=data.getRoot(setting).curSelectedList;for(var i=0,l=list.length;i<l;i++){r.push(list[i])}return r},isSelectedNode:function(node){return data.isSelectedNode(setting,node)},reAsyncChildNodes:function(parentNode,reloadType,isSilent){if(!this.setting.async.enable){return}var isRoot=!parentNode;if(isRoot){parentNode=data.getRoot(setting)}if(reloadType=="refresh"){var childKey=this.setting.data.key.children;for(var i=0,l=parentNode[childKey]?parentNode[childKey].length:0;i<l;i++){data.removeNodeCache(setting,parentNode[childKey][i])}data.removeSelectedNode(setting);parentNode[childKey]=[];if(isRoot){this.setting.treeObj.empty()}else{var ulObj=$$(parentNode,consts.id.UL,setting);ulObj.empty()}}view.asyncNode(this.setting,isRoot?null:parentNode,!!isSilent)},refresh:function(){this.setting.treeObj.empty();var root=data.getRoot(setting),nodes=root[setting.data.key.children];data.initRoot(setting);root[setting.data.key.children]=nodes;data.initCache(setting);view.createNodes(setting,0,root[setting.data.key.children],null,-1)},removeChildNodes:function(node){if(!node){return null}var childKey=setting.data.key.children,nodes=node[childKey];view.removeChildNodes(setting,node);return nodes?nodes:null},removeNode:function(node,callbackFlag){if(!node){return}callbackFlag=!!callbackFlag;if(callbackFlag&&tools.apply(setting.callback.beforeRemove,[setting.treeId,node],true)==false){return}view.removeNode(setting,node);if(callbackFlag){this.setting.treeObj.trigger(consts.event.REMOVE,[setting.treeId,node])}},selectNode:function(node,addFlag){if(!node){return}if(tools.uCanDo(setting)){addFlag=setting.view.selectedMulti&&addFlag;if(node.parentTId){view.expandCollapseParentNode(setting,node.getParentNode(),true,false,showNodeFocus)}else{try{$$(node,setting).focus().blur()}catch(e){}}view.selectNode(setting,node,addFlag)}function showNodeFocus(){var a=$$(node,setting).get(0);if(a){if(a.scrollIntoView){a.scrollIntoView(false)}else{try{a.focus().blur()}catch(e){}}}}},transformTozTreeNodes:function(simpleNodes){return data.transformTozTreeFormat(setting,simpleNodes)},transformToArray:function(nodes){return data.transformToArrayFormat(setting,nodes)},updateNode:function(node,checkTypeFlag){if(!node){return}var nObj=$$(node,setting);if(nObj.get(0)&&tools.uCanDo(setting)){view.setNodeName(setting,node);view.setNodeTarget(setting,node);view.setNodeUrl(setting,node);view.setNodeLineIcos(setting,node);view.setNodeFontCss(setting,node)}}};root.treeTools=zTreeTools;data.setZTreeTools(setting,zTreeTools);if(root[childKey]&&root[childKey].length>0){view.createNodes(setting,0,root[childKey],null,-1)}else{if(setting.async.enable&&setting.async.url&&setting.async.url!==""){view.asyncNode(setting)}}return zTreeTools}};var zt=$.fn.zTree,$$=tools.$,consts=zt.consts})(jQuery);(function(W){var L={event:{CHECK:"ztree_check"},id:{CHECK:"_check"},checkbox:{STYLE:"checkbox",DEFAULT:"chk",DISABLED:"disable",FALSE:"false",TRUE:"true",FULL:"full",PART:"part",FOCUS:"focus"},radio:{STYLE:"radio",TYPE_ALL:"all",TYPE_LEVEL:"level"}},O={check:{enable:false,autoCheckTrigger:false,chkStyle:L.checkbox.STYLE,nocheckInherit:false,chkDisabledInherit:false,radioType:L.radio.TYPE_LEVEL,chkboxType:{Y:"ps",N:"ps"}},data:{key:{checked:"checked"}},callback:{beforeCheck:null,onCheck:null}},E=function(b){var a=B.getRoot(b);a.radioCheckedList=[]},Y=function(a){},N=function(c){var b=c.treeObj,a=J.event;b.bind(a.CHECK,function(e,f,d,g){e.srcEvent=f;G.apply(c.callback.onCheck,[e,d,g])})},C=function(c){var b=c.treeObj,a=J.event;b.unbind(a.CHECK)},M=function(g){var f=g.target,d=B.getSetting(g.data.treeId),i="",b=null,a="",h="",c=null,j=null;if(G.eqs(g.type,"mouseover")){if(d.check.enable&&G.eqs(f.tagName,"span")&&f.getAttribute("treeNode"+J.id.CHECK)!==null){i=G.getNodeMainDom(f).id;a="mouseoverCheck"}}else{if(G.eqs(g.type,"mouseout")){if(d.check.enable&&G.eqs(f.tagName,"span")&&f.getAttribute("treeNode"+J.id.CHECK)!==null){i=G.getNodeMainDom(f).id;a="mouseoutCheck"}}else{if(G.eqs(g.type,"click")){if(d.check.enable&&G.eqs(f.tagName,"span")&&f.getAttribute("treeNode"+J.id.CHECK)!==null){i=G.getNodeMainDom(f).id;a="checkNode"}}}}if(i.length>0){b=B.getNodeCache(d,i);switch(a){case"checkNode":c=P.onCheckNode;break;case"mouseoverCheck":c=P.onMouseoverCheck;break;case"mouseoutCheck":c=P.onMouseoutCheck;break}}var e={stop:a==="checkNode",node:b,nodeEventType:a,nodeEventCallback:c,treeEventType:h,treeEventCallback:j};return e},F=function(d,a,h,g,e,f,i){if(!h){return}var b=d.data.key.checked;if(typeof h[b]=="string"){h[b]=G.eqs(h[b],"true")}h[b]=!!h[b];h.checkedOld=h[b];if(typeof h.nocheck=="string"){h.nocheck=G.eqs(h.nocheck,"true")}h.nocheck=!!h.nocheck||(d.check.nocheckInherit&&g&&!!g.nocheck);if(typeof h.chkDisabled=="string"){h.chkDisabled=G.eqs(h.chkDisabled,"true")}h.chkDisabled=!!h.chkDisabled||(d.check.chkDisabledInherit&&g&&!!g.chkDisabled);if(typeof h.halfCheck=="string"){h.halfCheck=G.eqs(h.halfCheck,"true")}h.halfCheck=!!h.halfCheck;h.check_Child_State=-1;h.check_Focus=false;h.getCheckStatus=function(){return B.getCheckStatus(d,h)};if(d.check.chkStyle==J.radio.STYLE&&d.check.radioType==J.radio.TYPE_ALL&&h[b]){var c=B.getRoot(d);c.radioCheckedList.push(h)}},ab=function(b,a,c){var d=b.data.key.checked;if(b.check.enable){B.makeChkFlag(b,a);c.push("<span ID='",a.tId,J.id.CHECK,"' class='",R.makeChkClass(b,a),"' treeNode",J.id.CHECK,(a.nocheck===true?" style='display:none;'":""),"></span>")}},Q=function(a,b){b.checkNode=function(e,f,d,g){var i=this.setting.data.key.checked;if(e.chkDisabled===true){return}if(f!==true&&f!==false){f=!e[i]}g=!!g;if(e[i]===f&&!d){return}else{if(g&&G.apply(this.setting.callback.beforeCheck,[this.setting.treeId,e],true)==false){return}}if(G.uCanDo(this.setting)&&this.setting.check.enable&&e.nocheck!==true){e[i]=f;var h=S(e,J.id.CHECK,this.setting);if(d||this.setting.check.chkStyle===J.radio.STYLE){R.checkNodeRelation(this.setting,e)}R.setChkClass(this.setting,h,e);R.repairParentChkClassWithSelf(this.setting,e);if(g){this.setting.treeObj.trigger(J.event.CHECK,[null,this.setting.treeId,e])}}};b.checkAllNodes=function(d){R.repairAllChk(this.setting,!!d)};b.getCheckedNodes=function(d){var e=this.setting.data.key.children;d=(d!==false);return B.getTreeCheckedNodes(this.setting,B.getRoot(this.setting)[e],d)};b.getChangeCheckedNodes=function(){var d=this.setting.data.key.children;return B.getTreeChangeCheckedNodes(this.setting,B.getRoot(this.setting)[d])};b.setChkDisabled=function(f,g,e,d){g=!!g;e=!!e;d=!!d;R.repairSonChkDisabled(this.setting,f,g,d);R.repairParentChkDisabled(this.setting,f.getParentNode(),g,e)};var c=b.updateNode;b.updateNode=function(e,d){if(c){c.apply(b,arguments)}if(!e||!this.setting.check.enable){return}var g=S(e,this.setting);if(g.get(0)&&G.uCanDo(this.setting)){var f=S(e,J.id.CHECK,this.setting);if(d==true||this.setting.check.chkStyle===J.radio.STYLE){R.checkNodeRelation(this.setting,e)}R.setChkClass(this.setting,f,e);R.repairParentChkClassWithSelf(this.setting,e)}}},K={getRadioCheckedList:function(a){var b=B.getRoot(a).radioCheckedList;for(var c=0,d=b.length;c<d;c++){if(!B.getNodeCache(a,b[c].tId)){b.splice(c,1);c--;d--}}return b},getCheckStatus:function(c,a){if(!c.check.enable||a.nocheck||a.chkDisabled){return null}var d=c.data.key.checked,b={checked:a[d],half:a.halfCheck?a.halfCheck:(c.check.chkStyle==J.radio.STYLE?(a.check_Child_State===2):(a[d]?(a.check_Child_State>-1&&a.check_Child_State<2):(a.check_Child_State>0)))};return b},getTreeCheckedNodes:function(d,b,e,h){if(!b){return[]}var a=d.data.key.children,c=d.data.key.checked,f=(e&&d.check.chkStyle==J.radio.STYLE&&d.check.radioType==J.radio.TYPE_ALL);h=!h?[]:h;for(var g=0,i=b.length;g<i;g++){if(b[g].nocheck!==true&&b[g].chkDisabled!==true&&b[g][c]==e){h.push(b[g]);if(f){break}}B.getTreeCheckedNodes(d,b[g][a],e,h);if(f&&h.length>0){break}}return h},getTreeChangeCheckedNodes:function(b,e,c){if(!e){return[]}var a=b.data.key.children,f=b.data.key.checked;c=!c?[]:c;for(var d=0,g=e.length;d<g;d++){if(e[d].nocheck!==true&&e[d].chkDisabled!==true&&e[d][f]!=e[d].checkedOld){c.push(e[d])}B.getTreeChangeCheckedNodes(b,e[d][a],c)}return c},makeChkFlag:function(e,a){if(!a){return}var b=e.data.key.children,c=e.data.key.checked,h=-1;if(a[b]){for(var f=0,i=a[b].length;f<i;f++){var d=a[b][f];var g=-1;if(e.check.chkStyle==J.radio.STYLE){if(d.nocheck===true||d.chkDisabled===true){g=d.check_Child_State}else{if(d.halfCheck===true){g=2}else{if(d[c]){g=2}else{g=d.check_Child_State>0?2:0}}}if(g==2){h=2;break}else{if(g==0){h=0}}}else{if(e.check.chkStyle==J.checkbox.STYLE){if(d.nocheck===true||d.chkDisabled===true){g=d.check_Child_State}else{if(d.halfCheck===true){g=1}else{if(d[c]){g=(d.check_Child_State===-1||d.check_Child_State===2)?2:1}else{g=(d.check_Child_State>0)?1:0}}}if(g===1){h=1;break}else{if(g===2&&h>-1&&f>0&&g!==h){h=1;break}else{if(h===2&&g>-1&&g<2){h=1;break}else{if(g>-1){h=g}}}}}}}}a.check_Child_State=h}},U={},P={onCheckNode:function(a,b){if(b.chkDisabled===true){return false}var c=B.getSetting(a.data.treeId),e=c.data.key.checked;if(G.apply(c.callback.beforeCheck,[c.treeId,b],true)==false){return true}b[e]=!b[e];R.checkNodeRelation(c,b);var d=S(b,J.id.CHECK,c);R.setChkClass(c,d,b);R.repairParentChkClassWithSelf(c,b);c.treeObj.trigger(J.event.CHECK,[a,c.treeId,b]);return true},onMouseoverCheck:function(a,b){if(b.chkDisabled===true){return false}var c=B.getSetting(a.data.treeId),d=S(b,J.id.CHECK,c);b.check_Focus=true;R.setChkClass(c,d,b);return true},onMouseoutCheck:function(a,b){if(b.chkDisabled===true){return false}var c=B.getSetting(a.data.treeId),d=S(b,J.id.CHECK,c);b.check_Focus=false;R.setChkClass(c,d,b);return true}},T={},X={checkNodeRelation:function(d,j){var f,h,i,a=d.data.key.children,b=d.data.key.checked,c=J.radio;if(d.check.chkStyle==c.STYLE){var e=B.getRadioCheckedList(d);if(j[b]){if(d.check.radioType==c.TYPE_ALL){for(h=e.length-1;h>=0;h--){f=e[h];if(f[b]&&f!=j){f[b]=false;e.splice(h,1);R.setChkClass(d,S(f,J.id.CHECK,d),f);if(f.parentTId!=j.parentTId){R.repairParentChkClassWithSelf(d,f)}}}e.push(j)}else{var g=(j.parentTId)?j.getParentNode():B.getRoot(d);for(h=0,i=g[a].length;h<i;h++){f=g[a][h];if(f[b]&&f!=j){f[b]=false;R.setChkClass(d,S(f,J.id.CHECK,d),f)}}}}else{if(d.check.radioType==c.TYPE_ALL){for(h=0,i=e.length;h<i;h++){if(j==e[h]){e.splice(h,1);break}}}}}else{if(j[b]&&(!j[a]||j[a].length==0||d.check.chkboxType.Y.indexOf("s")>-1)){R.setSonNodeCheckBox(d,j,true)}if(!j[b]&&(!j[a]||j[a].length==0||d.check.chkboxType.N.indexOf("s")>-1)){R.setSonNodeCheckBox(d,j,false)}if(j[b]&&d.check.chkboxType.Y.indexOf("p")>-1){R.setParentNodeCheckBox(d,j,true)}if(!j[b]&&d.check.chkboxType.N.indexOf("p")>-1){R.setParentNodeCheckBox(d,j,false)}}},makeChkClass:function(f,c){var g=f.data.key.checked,a=J.checkbox,d=J.radio,b="";if(c.chkDisabled===true){b=a.DISABLED}else{if(c.halfCheck){b=a.PART}else{if(f.check.chkStyle==d.STYLE){b=(c.check_Child_State<1)?a.FULL:a.PART}else{b=c[g]?((c.check_Child_State===2||c.check_Child_State===-1)?a.FULL:a.PART):((c.check_Child_State<1)?a.FULL:a.PART)}}}var e=f.check.chkStyle+"_"+(c[g]?a.TRUE:a.FALSE)+"_"+b;e=(c.check_Focus&&c.chkDisabled!==true)?e+"_"+a.FOCUS:e;return J.className.BUTTON+" "+a.DEFAULT+" "+e},repairAllChk:function(d,a){if(d.check.enable&&d.check.chkStyle===J.checkbox.STYLE){var f=d.data.key.checked,b=d.data.key.children,g=B.getRoot(d);for(var e=0,h=g[b].length;e<h;e++){var c=g[b][e];if(c.nocheck!==true&&c.chkDisabled!==true){c[f]=a}R.setSonNodeCheckBox(d,c,a)}}},repairChkClass:function(b,a){if(!a){return}B.makeChkFlag(b,a);if(a.nocheck!==true){var c=S(a,J.id.CHECK,b);R.setChkClass(b,c,a)}},repairParentChkClass:function(b,a){if(!a||!a.parentTId){return}var c=a.getParentNode();R.repairChkClass(b,c);R.repairParentChkClass(b,c)},repairParentChkClassWithSelf:function(c,a){if(!a){return}var b=c.data.key.children;if(a[b]&&a[b].length>0){R.repairParentChkClass(c,a[b][0])}else{R.repairParentChkClass(c,a)}},repairSonChkDisabled:function(c,a,d,f){if(!a){return}var b=c.data.key.children;if(a.chkDisabled!=d){a.chkDisabled=d}R.repairChkClass(c,a);if(a[b]&&f){for(var e=0,g=a[b].length;e<g;e++){var h=a[b][e];R.repairSonChkDisabled(c,h,d,f)}}},repairParentChkDisabled:function(b,a,c,d){if(!a){return}if(a.chkDisabled!=c&&d){a.chkDisabled=c}R.repairChkClass(b,a);R.repairParentChkDisabled(b,a.getParentNode(),c,d)},setChkClass:function(c,a,b){if(!a){return}if(b.nocheck===true){a.hide()}else{a.show()}a.attr("class",R.makeChkClass(c,b))},setParentNodeCheckBox:function(d,k,e,h){var a=d.data.key.children,c=d.data.key.checked,g=S(k,J.id.CHECK,d);if(!h){h=k}B.makeChkFlag(d,k);if(k.nocheck!==true&&k.chkDisabled!==true){k[c]=e;R.setChkClass(d,g,k);if(d.check.autoCheckTrigger&&k!=h){d.treeObj.trigger(J.event.CHECK,[null,d.treeId,k])}}if(k.parentTId){var f=true;if(!e){var b=k.getParentNode()[a];for(var i=0,j=b.length;i<j;i++){if((b[i].nocheck!==true&&b[i].chkDisabled!==true&&b[i][c])||((b[i].nocheck===true||b[i].chkDisabled===true)&&b[i].check_Child_State>0)){f=false;break}}}if(f){R.setParentNodeCheckBox(d,k.getParentNode(),e,h)}}},setSonNodeCheckBox:function(d,k,e,h){if(!k){return}var a=d.data.key.children,c=d.data.key.checked,g=S(k,J.id.CHECK,d);if(!h){h=k}var b=false;if(k[a]){for(var i=0,j=k[a].length;i<j;i++){var f=k[a][i];R.setSonNodeCheckBox(d,f,e,h);if(f.chkDisabled===true){b=true}}}if(k!=B.getRoot(d)&&k.chkDisabled!==true){if(b&&k.nocheck!==true){B.makeChkFlag(d,k)}if(k.nocheck!==true&&k.chkDisabled!==true){k[c]=e;if(!b){k.check_Child_State=(k[a]&&k[a].length>0)?(e?2:0):-1}}else{k.check_Child_State=-1}R.setChkClass(d,g,k);if(d.check.autoCheckTrigger&&k!=h&&k.nocheck!==true&&k.chkDisabled!==true){d.treeObj.trigger(J.event.CHECK,[null,d.treeId,k])}}}},H={tools:T,view:X,event:U,data:K};W.extend(true,W.fn.zTree.consts,L);W.extend(true,W.fn.zTree._z,H);var Z=W.fn.zTree,G=Z._z.tools,J=Z.consts,R=Z._z.view,B=Z._z.data,I=Z._z.event,S=G.$;B.exSetting(O);B.addInitBind(N);B.addInitUnBind(C);B.addInitCache(Y);B.addInitNode(F);B.addInitProxy(M,true);B.addInitRoot(E);B.addBeforeA(ab);B.addZTreeTools(Q);var D=R.createNodes;R.createNodes=function(b,a,d,e,c){if(D){D.apply(R,arguments)}if(!d){return}R.repairParentChkClassWithSelf(b,e)};var aa=R.removeNode;R.removeNode=function(b,a){var c=a.getParentNode();if(aa){aa.apply(R,arguments)}if(!a||!c){return}R.repairChkClass(b,c);R.repairParentChkClass(b,c)};var V=R.appendNodes;R.appendNodes=function(c,a,g,h,f,d,b){var e="";if(V){e=V.apply(R,arguments)}if(h){B.makeChkFlag(c,h)}return e}})(jQuery);(function(aa){var M={event:{DRAG:"ztree_drag",DROP:"ztree_drop",RENAME:"ztree_rename",DRAGMOVE:"ztree_dragmove"},id:{EDIT:"_edit",INPUT:"_input",REMOVE:"_remove"},move:{TYPE_INNER:"inner",TYPE_PREV:"prev",TYPE_NEXT:"next"},node:{CURSELECTED_EDIT:"curSelectedNode_Edit",TMPTARGET_TREE:"tmpTargetzTree",TMPTARGET_NODE:"tmpTargetNode"}},T={edit:{enable:false,editNameSelectAll:false,showRemoveBtn:true,showRenameBtn:true,removeTitle:"remove",renameTitle:"rename",drag:{autoExpandTrigger:false,isCopy:true,isMove:true,prev:true,next:true,inner:true,minMoveSize:5,borderMax:10,borderMin:-5,maxShowNodeNum:5,autoOpenTime:500}},view:{addHoverDom:null,removeHoverDom:null},callback:{beforeDrag:null,beforeDragOpen:null,beforeDrop:null,beforeEditName:null,beforeRename:null,onDrag:null,onDragMove:null,onDrop:null,onRename:null}},F=function(b){var a=P.getRoot(b),c=P.getRoots();a.curEditNode=null;a.curEditInput=null;a.curHoverNode=null;a.dragFlag=0;a.dragNodeShowBefore=[];a.dragMaskList=new Array();c.showHoverDom=true},ad=function(a){},S=function(c){var b=c.treeObj;var a=O.event;b.bind(a.RENAME,function(f,d,e,g){H.apply(c.callback.onRename,[f,d,e,g])});b.bind(a.DRAG,function(f,g,d,e){H.apply(c.callback.onDrag,[g,d,e])});b.bind(a.DRAGMOVE,function(f,g,d,e){H.apply(c.callback.onDragMove,[g,d,e])});b.bind(a.DROP,function(f,g,d,e,j,h,i){H.apply(c.callback.onDrop,[g,d,e,j,h,i])})},D=function(c){var b=c.treeObj;var a=O.event;b.unbind(a.RENAME);b.unbind(a.DRAG);b.unbind(a.DRAGMOVE);b.unbind(a.DROP)},R=function(f){var e=f.target,b=P.getSetting(f.data.treeId),d=f.relatedTarget,h="",l=null,k="",g="",a=null,i=null,j=null;if(H.eqs(f.type,"mouseover")){j=H.getMDom(b,e,[{tagName:"a",attrName:"treeNode"+O.id.A}]);if(j){h=H.getNodeMainDom(j).id;k="hoverOverNode"}}else{if(H.eqs(f.type,"mouseout")){j=H.getMDom(b,d,[{tagName:"a",attrName:"treeNode"+O.id.A}]);if(!j){h="remove";k="hoverOutNode"}}else{if(H.eqs(f.type,"mousedown")){j=H.getMDom(b,e,[{tagName:"a",attrName:"treeNode"+O.id.A}]);if(j){h=H.getNodeMainDom(j).id;k="mousedownNode"}}}}if(h.length>0){l=P.getNodeCache(b,h);switch(k){case"mousedownNode":a=U.onMousedownNode;break;case"hoverOverNode":a=U.onHoverOverNode;break;case"hoverOutNode":a=U.onHoverOutNode;break}}var c={stop:false,node:l,nodeEventType:k,nodeEventCallback:a,treeEventType:g,treeEventCallback:i};return c},G=function(e,a,b,g,c,f,d){if(!b){return}b.isHover=false;b.editNameFlag=false},V=function(a,b){b.cancelEditName=function(c){var d=P.getRoot(this.setting);if(!d.curEditNode){return}W.cancelCurEditNode(this.setting,c?c:null,true)};b.copyNode=function(e,f,g,c){if(!f){return null}if(e&&!e.isParent&&this.setting.data.keep.leaf&&g===O.move.TYPE_INNER){return null}var d=this,i=H.clone(f);if(!e){e=null;g=O.move.TYPE_INNER}if(g==O.move.TYPE_INNER){function h(){W.addNodes(d.setting,e,-1,[i],c)}if(H.canAsync(this.setting,e)){W.asyncNode(this.setting,e,c,h)}else{h()}}else{W.addNodes(this.setting,e.parentNode,-1,[i],c);W.moveNode(this.setting,e,i,g,false,c)}return i};b.editName=function(c){if(!c||!c.tId||c!==P.getNodeCache(this.setting,c.tId)){return}if(c.parentTId){W.expandCollapseParentNode(this.setting,c.getParentNode(),true)}W.editNode(this.setting,c)};b.moveNode=function(f,g,h,c){if(!g){return g}if(f&&!f.isParent&&this.setting.data.keep.leaf&&h===O.move.TYPE_INNER){return null}else{if(f&&((g.parentTId==f.tId&&h==O.move.TYPE_INNER)||X(g,this.setting).find("#"+f.tId).length>0)){return null}else{if(!f){f=null}}}var d=this;function e(){W.moveNode(d.setting,f,g,h,false,c)}if(H.canAsync(this.setting,f)&&h===O.move.TYPE_INNER){W.asyncNode(this.setting,f,c,e)}else{e()}return g};b.setEditable=function(c){this.setting.edit.enable=c;return this.refresh()}},Q={setSonNodeLevel:function(c,f,a){if(!a){return}var b=c.data.key.children;a.level=(f)?f.level+1:0;if(!a[b]){return}for(var d=0,e=a[b].length;d<e;d++){if(a[b][d]){P.setSonNodeLevel(c,a,a[b][d])}}}},Z={},U={onHoverOverNode:function(a,b){var c=P.getSetting(a.data.treeId),d=P.getRoot(c);if(d.curHoverNode!=b){U.onHoverOutNode(a)}d.curHoverNode=b;W.addHoverDom(c,b)},onHoverOutNode:function(a,b){var c=P.getSetting(a.data.treeId),d=P.getRoot(c);if(d.curHoverNode&&!P.isSelectedNode(c,d.curHoverNode)){W.removeTreeDom(c,d.curHoverNode);d.curHoverNode=null}},onMousedownNode:function(h,p){var ag,c,i=P.getSetting(h.data.treeId),d=P.getRoot(i),o=P.getRoots();if(h.button==2||!i.edit.enable||(!i.edit.drag.isCopy&&!i.edit.drag.isMove)){return true}var A=h.target,q=P.getRoot(i).curSelectedList,g=[];if(!P.isSelectedNode(i,p)){g=[p]}else{for(ag=0,c=q.length;ag<c;ag++){if(q[ag].editNameFlag&&H.eqs(A.tagName,"input")&&A.getAttribute("treeNode"+O.id.INPUT)!==null){return true}g.push(q[ag]);if(g[0].parentTId!==q[ag].parentTId){g=[p];break}}}W.editNodeBlur=true;W.cancelCurEditNode(i);var x=aa(i.treeObj.get(0).ownerDocument),n=aa(i.treeObj.get(0).ownerDocument.body),a,m,C,B=false,z=i,r=i,w,s,f=null,t=null,j=null,v=O.move.TYPE_INNER,b=h.clientX,e=h.clientY,l=(new Date()).getTime();if(H.uCanDo(i)){x.bind("mousemove",k)}function k(bR){if(d.dragFlag==0&&Math.abs(b-bR.clientX)<i.edit.drag.minMoveSize&&Math.abs(e-bR.clientY)<i.edit.drag.minMoveSize){return true}var bX,bt,a9,by,bG,bz=i.data.key.children;n.css("cursor","pointer");if(d.dragFlag==0){if(H.apply(i.callback.beforeDrag,[i.treeId,g],true)==false){y(bR);return true}for(bX=0,bt=g.length;bX<bt;bX++){if(bX==0){d.dragNodeShowBefore=[]}a9=g[bX];if(a9.isParent&&a9.open){W.expandCollapseNode(i,a9,!a9.open);d.dragNodeShowBefore[a9.tId]=true}else{d.dragNodeShowBefore[a9.tId]=false}}d.dragFlag=1;o.showHoverDom=false;H.showIfameMask(i,true);var bo=true,bl=-1;if(g.length>1){var bb=g[0].parentTId?g[0].getParentNode()[bz]:P.getNodes(i);bG=[];for(bX=0,bt=bb.length;bX<bt;bX++){if(d.dragNodeShowBefore[bb[bX].tId]!==undefined){if(bo&&bl>-1&&(bl+1)!==bX){bo=false}bG.push(bb[bX]);bl=bX}if(g.length===bG.length){g=bG;break}}}if(bo){w=g[0].getPreNode();s=g[g.length-1].getNextNode()}a=X("<ul class='zTreeDragUL'></ul>",i);for(bX=0,bt=g.length;bX<bt;bX++){a9=g[bX];a9.editNameFlag=false;W.selectNode(i,a9,bX>0);W.removeTreeDom(i,a9);if(bX>i.edit.drag.maxShowNodeNum-1){continue}by=X("<li id='"+a9.tId+"_tmp'></li>",i);by.append(X(a9,O.id.A,i).clone());by.css("padding","0");by.children("#"+a9.tId+O.id.A).removeClass(O.node.CURSELECTED);a.append(by);if(bX==i.edit.drag.maxShowNodeNum-1){by=X("<li id='"+a9.tId+"_moretmp'><a>  ...  </a></li>",i);a.append(by)}}a.attr("id",g[0].tId+O.id.UL+"_tmp");a.addClass(i.treeObj.attr("class"));a.appendTo(n);m=X("<span class='tmpzTreeMove_arrow'></span>",i);m.attr("id","zTreeMove_arrow_tmp");m.appendTo(n);i.treeObj.trigger(O.event.DRAG,[bR,i.treeId,g])}if(d.dragFlag==1){if(C&&m.attr("id")==bR.target.id&&j&&(bR.clientX+x.scrollLeft()+2)>(aa("#"+j+O.id.A,C).offset().left)){var bS=aa("#"+j+O.id.A,C);bR.target=(bS.length>0)?bS.get(0):bR.target}else{if(C){C.removeClass(O.node.TMPTARGET_TREE);if(j){aa("#"+j+O.id.A,C).removeClass(O.node.TMPTARGET_NODE+"_"+O.move.TYPE_PREV).removeClass(O.node.TMPTARGET_NODE+"_"+M.move.TYPE_NEXT).removeClass(O.node.TMPTARGET_NODE+"_"+M.move.TYPE_INNER)}}}C=null;j=null;B=false;z=i;var bW=P.getSettings();for(var bx in bW){if(bW[bx].treeId&&bW[bx].edit.enable&&bW[bx].treeId!=i.treeId&&(bR.target.id==bW[bx].treeId||aa(bR.target).parents("#"+bW[bx].treeId).length>0)){B=true;z=bW[bx]}}var bc=x.scrollTop(),bT=x.scrollLeft(),bn=z.treeObj.offset(),bM=z.treeObj.get(0).scrollHeight,bw=z.treeObj.get(0).scrollWidth,bV=(bR.clientY+bc-bn.top),bA=(z.treeObj.height()+bn.top-bR.clientY-bc),bF=(bR.clientX+bT-bn.left),bd=(z.treeObj.width()+bn.left-bR.clientX-bT),ba=(bV<i.edit.drag.borderMax&&bV>i.edit.drag.borderMin),bQ=(bA<i.edit.drag.borderMax&&bA>i.edit.drag.borderMin),bC=(bF<i.edit.drag.borderMax&&bF>i.edit.drag.borderMin),bf=(bd<i.edit.drag.borderMax&&bd>i.edit.drag.borderMin),bm=bV>i.edit.drag.borderMin&&bA>i.edit.drag.borderMin&&bF>i.edit.drag.borderMin&&bd>i.edit.drag.borderMin,bI=(ba&&z.treeObj.scrollTop()<=0),bJ=(bQ&&(z.treeObj.scrollTop()+z.treeObj.height()+10)>=bM),bj=(bC&&z.treeObj.scrollLeft()<=0),bO=(bf&&(z.treeObj.scrollLeft()+z.treeObj.width()+10)>=bw);if(bR.target&&H.isChildOrSelf(bR.target,z.treeId)){var be=bR.target;while(be&&be.tagName&&!H.eqs(be.tagName,"li")&&be.id!=z.treeId){be=be.parentNode}var bP=true;for(bX=0,bt=g.length;bX<bt;bX++){a9=g[bX];if(be.id===a9.tId){bP=false;break}else{if(X(a9,i).find("#"+be.id).length>0){bP=false;break}}}if(bP&&bR.target&&H.isChildOrSelf(bR.target,be.id+O.id.A)){C=aa(be);j=be.id}}a9=g[0];if(bm&&H.isChildOrSelf(bR.target,z.treeId)){if(!C&&(bR.target.id==z.treeId||bI||bJ||bj||bO)&&(B||(!B&&a9.parentTId))){C=z.treeObj}if(ba){z.treeObj.scrollTop(z.treeObj.scrollTop()-10)}else{if(bQ){z.treeObj.scrollTop(z.treeObj.scrollTop()+10)}}if(bC){z.treeObj.scrollLeft(z.treeObj.scrollLeft()-10)}else{if(bf){z.treeObj.scrollLeft(z.treeObj.scrollLeft()+10)}}if(C&&C!=z.treeObj&&C.offset().left<z.treeObj.offset().left){z.treeObj.scrollLeft(z.treeObj.scrollLeft()+C.offset().left-z.treeObj.offset().left)}}a.css({top:(bR.clientY+bc+3)+"px",left:(bR.clientX+bT+3)+"px"});var bK=0;var bL=0;if(C&&C.attr("id")!=z.treeId){var bB=j==null?null:P.getNodeCache(z,j),bH=((bR.ctrlKey||bR.metaKey)&&i.edit.drag.isMove&&i.edit.drag.isCopy)||(!i.edit.drag.isMove&&i.edit.drag.isCopy),bh=!!(w&&j===w.tId),bD=!!(s&&j===s.tId),br=(a9.parentTId&&a9.parentTId==j),bE=(bH||!bD)&&H.apply(z.edit.drag.prev,[z.treeId,g,bB],!!z.edit.drag.prev),bi=(bH||!bh)&&H.apply(z.edit.drag.next,[z.treeId,g,bB],!!z.edit.drag.next),bp=(bH||!br)&&!(z.data.keep.leaf&&!bB.isParent)&&H.apply(z.edit.drag.inner,[z.treeId,g,bB],!!z.edit.drag.inner);function bU(){C=null;j="";v=O.move.TYPE_INNER;m.css({display:"none"});if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}}if(!bE&&!bi&&!bp){bU()}else{var bN=aa("#"+j+O.id.A,C),bu=bB.isLastNode?null:aa("#"+bB.getNextNode().tId+O.id.A,C.next()),bs=bN.offset().top,bq=bN.offset().left,bv=bE?(bp?0.25:(bi?0.5:1)):-1,bg=bi?(bp?0.75:(bE?0.5:0)):-1,bk=(bR.clientY+bc-bs)/bN.height();if((bv==1||bk<=bv&&bk>=-0.2)&&bE){bK=1-m.width();bL=bs-m.height()/2;v=O.move.TYPE_PREV}else{if((bg==0||bk>=bg&&bk<=1.2)&&bi){bK=1-m.width();bL=(bu==null||(bB.isParent&&bB.open))?(bs+bN.height()-m.height()/2):(bu.offset().top-m.height()/2);v=O.move.TYPE_NEXT}else{if(bp){bK=5-m.width();bL=bs;v=O.move.TYPE_INNER}else{bU()}}}if(C){m.css({display:"block",top:bL+"px",left:(bq+bK)+"px"});bN.addClass(O.node.TMPTARGET_NODE+"_"+v);if(f!=j||t!=v){l=(new Date()).getTime()}if(bB&&bB.isParent&&v==O.move.TYPE_INNER){var a8=true;if(window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId!==bB.tId){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}else{if(window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId===bB.tId){a8=false}}if(a8){window.zTreeMoveTimer=setTimeout(function(){if(v!=O.move.TYPE_INNER){return}if(bB&&bB.isParent&&!bB.open&&(new Date()).getTime()-l>z.edit.drag.autoOpenTime&&H.apply(z.callback.beforeDragOpen,[z.treeId,bB],true)){W.switchNode(z,bB);if(z.edit.drag.autoExpandTrigger){z.treeObj.trigger(O.event.EXPAND,[z.treeId,bB])}}},z.edit.drag.autoOpenTime+50);window.zTreeMoveTargetNodeTId=bB.tId}}}}}else{v=O.move.TYPE_INNER;if(C&&H.apply(z.edit.drag.inner,[z.treeId,g,null],!!z.edit.drag.inner)){C.addClass(O.node.TMPTARGET_TREE)}else{C=null}m.css({display:"none"});if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}}f=j;t=v;i.treeObj.trigger(O.event.DRAGMOVE,[bR,i.treeId,g])}return false}x.bind("mouseup",y);function y(ar){if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer);window.zTreeMoveTargetNodeTId=null}f=null;t=null;x.unbind("mousemove",k);x.unbind("mouseup",y);x.unbind("selectstart",u);n.css("cursor","auto");if(C){C.removeClass(O.node.TMPTARGET_TREE);if(j){aa("#"+j+O.id.A,C).removeClass(O.node.TMPTARGET_NODE+"_"+O.move.TYPE_PREV).removeClass(O.node.TMPTARGET_NODE+"_"+M.move.TYPE_NEXT).removeClass(O.node.TMPTARGET_NODE+"_"+M.move.TYPE_INNER)}}H.showIfameMask(i,false);o.showHoverDom=true;if(d.dragFlag==0){return}d.dragFlag=0;var au,ap,at;for(au=0,ap=g.length;au<ap;au++){at=g[au];if(at.isParent&&d.dragNodeShowBefore[at.tId]&&!at.open){W.expandCollapseNode(i,at,!at.open);delete d.dragNodeShowBefore[at.tId]}}if(a){a.remove()}if(m){m.remove()}var aq=((ar.ctrlKey||ar.metaKey)&&i.edit.drag.isMove&&i.edit.drag.isCopy)||(!i.edit.drag.isMove&&i.edit.drag.isCopy);if(!aq&&C&&j&&g[0].parentTId&&j==g[0].parentTId&&v==O.move.TYPE_INNER){C=null}if(C){var ax=j==null?null:P.getNodeCache(z,j);if(H.apply(i.callback.beforeDrop,[z.treeId,g,ax,v,aq],true)==false){W.selectNodes(r,g);return}var aw=aq?H.clone(g):g;function av(){if(B){if(!aq){for(var ai=0,aj=g.length;ai<aj;ai++){W.removeNode(i,g[ai])}}if(v==O.move.TYPE_INNER){W.addNodes(z,ax,-1,aw)}else{W.addNodes(z,ax.getParentNode(),v==O.move.TYPE_PREV?ax.getIndex():ax.getIndex()+1,aw)}}else{if(aq&&v==O.move.TYPE_INNER){W.addNodes(z,ax,-1,aw)}else{if(aq){W.addNodes(z,ax.getParentNode(),v==O.move.TYPE_PREV?ax.getIndex():ax.getIndex()+1,aw)}else{if(v!=O.move.TYPE_NEXT){for(ai=0,aj=aw.length;ai<aj;ai++){W.moveNode(z,ax,aw[ai],v,false)}}else{for(ai=-1,aj=aw.length-1;ai<aj;aj--){W.moveNode(z,ax,aw[aj],v,false)}}}}}W.selectNodes(z,aw);var ak=X(aw[0],i).get(0);if(ak){if(ak.scrollIntoView){ak.scrollIntoView(false)}else{try{ak.focus().blur()}catch(ah){}}}i.treeObj.trigger(O.event.DROP,[ar,z.treeId,aw,ax,v,aq])}if(v==O.move.TYPE_INNER&&H.canAsync(z,ax)){W.asyncNode(z,ax,false,av)}else{av()}}else{W.selectNodes(r,g);i.treeObj.trigger(O.event.DROP,[ar,i.treeId,g,null,null,null])}}x.bind("selectstart",u);function u(){return false}if(h.preventDefault){h.preventDefault()}return true}},Y={getAbs:function(c){var a=c.getBoundingClientRect(),d=document.body.scrollTop+document.documentElement.scrollTop,b=document.body.scrollLeft+document.documentElement.scrollLeft;return[a.left+b,a.top+d]},inputFocus:function(a){if(a.get(0)){a.focus();H.setCursorPosition(a.get(0),a.val().length)}},inputSelect:function(a){if(a.get(0)){a.focus();a.select()}},setCursorPosition:function(b,a){if(b.setSelectionRange){b.focus();b.setSelectionRange(a,a)}else{if(b.createTextRange){var c=b.createTextRange();c.collapse(true);c.moveEnd("character",a);c.moveStart("character",a);c.select()}}},showIfameMask:function(c,e){var f=P.getRoot(c);while(f.dragMaskList.length>0){f.dragMaskList[0].remove();f.dragMaskList.shift()}if(e){var b=X("iframe",c);for(var g=0,i=b.length;g<i;g++){var h=b.get(g),a=H.getAbs(h),d=X("<div id='zTreeMask_"+g+"' class='zTreeMask' style='top:"+a[1]+"px; left:"+a[0]+"px; width:"+h.offsetWidth+"px; height:"+h.offsetHeight+"px;'></div>",c);d.appendTo(X("body",c));f.dragMaskList.push(d)}}}},ac={addEditBtn:function(c,b){if(b.editNameFlag||X(b,O.id.EDIT,c).length>0){return}if(!H.apply(c.edit.showRenameBtn,[c.treeId,b],c.edit.showRenameBtn)){return}var a=X(b,O.id.A,c),d="<span class='"+O.className.BUTTON+" edit' id='"+b.tId+O.id.EDIT+"' title='"+H.apply(c.edit.renameTitle,[c.treeId,b],c.edit.renameTitle)+"' treeNode"+O.id.EDIT+" style='display:none;'></span>";a.append(d);X(b,O.id.EDIT,c).bind("click",function(){if(!H.uCanDo(c)||H.apply(c.callback.beforeEditName,[c.treeId,b],true)==false){return false}W.editNode(c,b);return false}).show()},addRemoveBtn:function(d,c){if(c.editNameFlag||X(c,O.id.REMOVE,d).length>0){return}if(!H.apply(d.edit.showRemoveBtn,[d.treeId,c],d.edit.showRemoveBtn)){return}var a=X(c,O.id.A,d),b="<span class='"+O.className.BUTTON+" remove' id='"+c.tId+O.id.REMOVE+"' title='"+H.apply(d.edit.removeTitle,[d.treeId,c],d.edit.removeTitle)+"' treeNode"+O.id.REMOVE+" style='display:none;'></span>";a.append(b);X(c,O.id.REMOVE,d).bind("click",function(){if(!H.uCanDo(d)||H.apply(d.callback.beforeRemove,[d.treeId,c],true)==false){return false}W.removeNode(d,c);d.treeObj.trigger(O.event.REMOVE,[d.treeId,c]);return false}).bind("mousedown",function(e){return true}).show()},addHoverDom:function(b,a){if(P.getRoots().showHoverDom){a.isHover=true;if(b.edit.enable){W.addEditBtn(b,a);W.addRemoveBtn(b,a)}H.apply(b.view.addHoverDom,[b.treeId,a])}},cancelCurEditNode:function(c,b,f){var d=P.getRoot(c),g=c.data.key.name,i=d.curEditNode;if(i){var h=d.curEditInput,e=b?b:(f?i[g]:h.val());if(H.apply(c.callback.beforeRename,[c.treeId,i,e,f],true)===false){return false}i[g]=e;var a=X(i,O.id.A,c);a.removeClass(O.node.CURSELECTED_EDIT);h.unbind();W.setNodeName(c,i);i.editNameFlag=false;d.curEditNode=null;d.curEditInput=null;W.selectNode(c,i,false);c.treeObj.trigger(O.event.RENAME,[c.treeId,i,f])}d.noSelection=true;return true},editNode:function(b,a){var e=P.getRoot(b);W.editNodeBlur=false;if(P.isSelectedNode(b,a)&&e.curEditNode==a&&a.editNameFlag){setTimeout(function(){H.inputFocus(e.curEditInput)},0);return}var c=b.data.key.name;a.editNameFlag=true;W.removeTreeDom(b,a);W.cancelCurEditNode(b);W.selectNode(b,a,false);X(a,O.id.SPAN,b).html("<input type=text class='rename' id='"+a.tId+O.id.INPUT+"' treeNode"+O.id.INPUT+" >");var d=X(a,O.id.INPUT,b);d.attr("value",a[c]);if(b.edit.editNameSelectAll){H.inputSelect(d)}else{H.inputFocus(d)}d.bind("blur",function(f){if(!W.editNodeBlur){W.cancelCurEditNode(b)}}).bind("keydown",function(f){if(f.keyCode=="13"){W.editNodeBlur=true;W.cancelCurEditNode(b)}else{if(f.keyCode=="27"){W.cancelCurEditNode(b,null,true)}}}).bind("click",function(f){return false}).bind("dblclick",function(f){return false});X(a,O.id.A,b).addClass(O.node.CURSELECTED_EDIT);e.curEditInput=d;e.noSelection=false;e.curEditNode=a},moveNode:function(m,t,j,u,x,s){var h=P.getRoot(m),o=m.data.key.children;if(t==j){return}if(m.data.keep.leaf&&t&&!t.isParent&&u==O.move.TYPE_INNER){return}var e=(j.parentTId?j.getParentNode():h),k=(t===null||t==h);if(k&&t===null){t=h}if(k){u=O.move.TYPE_INNER}var w=(t.parentTId?t.getParentNode():h);if(u!=O.move.TYPE_PREV&&u!=O.move.TYPE_NEXT){u=O.move.TYPE_INNER}if(u==O.move.TYPE_INNER){if(k){j.parentTId=null}else{if(!t.isParent){t.isParent=true;t.open=!!t.open;W.setNodeLineIcos(m,t)}j.parentTId=t.tId}}var r,p;if(k){r=m.treeObj;p=r}else{if(!s&&u==O.move.TYPE_INNER){W.expandCollapseNode(m,t,true,false)}else{if(!s){W.expandCollapseNode(m,t.getParentNode(),true,false)}}r=X(t,m);p=X(t,O.id.UL,m);if(!!r.get(0)&&!p.get(0)){var a=[];W.makeUlHtml(m,t,a,"");r.append(a.join(""))}p=X(t,O.id.UL,m)}var c=X(j,m);if(!c.get(0)){c=W.appendNodes(m,j.level,[j],null,-1,false,true).join("")}else{if(!r.get(0)){c.remove()}}if(p.get(0)&&u==O.move.TYPE_INNER){p.append(c)}else{if(r.get(0)&&u==O.move.TYPE_PREV){r.before(c)}else{if(r.get(0)&&u==O.move.TYPE_NEXT){r.after(c)}}}var f,g,q=-1,d=0,y=null,v=null,b=j.level;if(j.isFirstNode){q=0;if(e[o].length>1){y=e[o][1];y.isFirstNode=true}}else{if(j.isLastNode){q=e[o].length-1;y=e[o][q-1];y.isLastNode=true}else{for(f=0,g=e[o].length;f<g;f++){if(e[o][f].tId==j.tId){q=f;break}}}}if(q>=0){e[o].splice(q,1)}if(u!=O.move.TYPE_INNER){for(f=0,g=w[o].length;f<g;f++){if(w[o][f].tId==t.tId){d=f}}}if(u==O.move.TYPE_INNER){if(!t[o]){t[o]=new Array()}if(t[o].length>0){v=t[o][t[o].length-1];v.isLastNode=false}t[o].splice(t[o].length,0,j);j.isLastNode=true;j.isFirstNode=(t[o].length==1)}else{if(t.isFirstNode&&u==O.move.TYPE_PREV){w[o].splice(d,0,j);v=t;v.isFirstNode=false;j.parentTId=t.parentTId;j.isFirstNode=true;j.isLastNode=false}else{if(t.isLastNode&&u==O.move.TYPE_NEXT){w[o].splice(d+1,0,j);v=t;v.isLastNode=false;j.parentTId=t.parentTId;j.isFirstNode=false;j.isLastNode=true}else{if(u==O.move.TYPE_PREV){w[o].splice(d,0,j)}else{w[o].splice(d+1,0,j)}j.parentTId=t.parentTId;j.isFirstNode=false;j.isLastNode=false}}}P.fixPIdKeyValue(m,j);P.setSonNodeLevel(m,j.getParentNode(),j);W.setNodeLineIcos(m,j);W.repairNodeLevelClass(m,j,b);if(!m.data.keep.parent&&e[o].length<1){e.isParent=false;e.open=false;var l=X(e,O.id.UL,m),i=X(e,O.id.SWITCH,m),n=X(e,O.id.ICON,m);W.replaceSwitchClass(e,i,O.folder.DOCU);W.replaceIcoClass(e,n,O.folder.DOCU);l.css("display","none")}else{if(y){W.setNodeLineIcos(m,y)}}if(v){W.setNodeLineIcos(m,v)}if(!!m.check&&m.check.enable&&W.repairChkClass){W.repairChkClass(m,e);W.repairParentChkClassWithSelf(m,e);if(e!=j.parent){W.repairParentChkClassWithSelf(m,j)}}if(!s){W.expandCollapseParentNode(m,j.getParentNode(),true,x)}},removeEditBtn:function(b,a){X(a,O.id.EDIT,b).unbind().remove()},removeRemoveBtn:function(b,a){X(a,O.id.REMOVE,b).unbind().remove()},removeTreeDom:function(b,a){a.isHover=false;W.removeEditBtn(b,a);W.removeRemoveBtn(b,a);H.apply(b.view.removeHoverDom,[b.treeId,a])},repairNodeLevelClass:function(g,e,f){if(f===e.level){return}var d=X(e,g),a=X(e,O.id.A,g),b=X(e,O.id.UL,g),h=O.className.LEVEL+f,c=O.className.LEVEL+e.level;d.removeClass(h);d.addClass(c);a.removeClass(h);a.addClass(c);b.removeClass(h);b.addClass(c)},selectNodes:function(a,c){for(var b=0,d=c.length;b<d;b++){W.selectNode(a,c[b],b>0)}}},J={tools:Y,view:ac,event:Z,data:Q};aa.extend(true,aa.fn.zTree.consts,M);aa.extend(true,aa.fn.zTree._z,J);var ae=aa.fn.zTree,H=ae._z.tools,O=ae.consts,W=ae._z.view,P=ae._z.data,K=ae._z.event,X=H.$;P.exSetting(T);P.addInitBind(S);P.addInitUnBind(D);P.addInitCache(ad);P.addInitNode(G);P.addInitProxy(R);P.addInitRoot(F);P.addZTreeTools(V);var I=W.cancelPreSelectedNode;W.cancelPreSelectedNode=function(c,b){var a=P.getRoot(c).curSelectedList;for(var d=0,e=a.length;d<e;d++){if(!b||b===a[d]){W.removeTreeDom(c,a[d]);if(b){break}}}if(I){I.apply(W,arguments)}};var E=W.createNodes;W.createNodes=function(b,a,d,e,c){if(E){E.apply(W,arguments)}if(!d){return}if(W.repairParentChkClassWithSelf){W.repairParentChkClassWithSelf(b,e)}};var L=W.makeNodeUrl;W.makeNodeUrl=function(b,a){return b.edit.enable?null:(L.apply(W,arguments))};var af=W.removeNode;W.removeNode=function(b,a){var c=P.getRoot(b);if(c.curEditNode===a){c.curEditNode=null}if(af){af.apply(W,arguments)}};var N=W.selectNode;W.selectNode=function(b,a,c){var d=P.getRoot(b);if(P.isSelectedNode(b,a)&&d.curEditNode==a&&a.editNameFlag){return false}if(N){N.apply(W,arguments)}W.addHoverDom(b,a);return true};var ab=H.uCanDo;H.uCanDo=function(b,a){var c=P.getRoot(b);if(a&&(H.eqs(a.type,"mouseover")||H.eqs(a.type,"mouseout")||H.eqs(a.type,"mousedown")||H.eqs(a.type,"mouseup"))){return true}if(c.curEditNode){W.editNodeBlur=false;c.curEditInput.focus()}return(!c.curEditNode)&&(ab?ab.apply(W,arguments):true)}})(jQuery);