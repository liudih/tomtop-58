function toDecimal2(a){var d=parseFloat(a);d=Math.round(d*100)/100;var c=d.toString();var b=c.indexOf(".");if(b<0){b=c.length;c+="."}while(c.length<=b+2){c+="0"}return c}function getUsablePoint(){var a=$("#islogin").val();if(a=="false"){return}$.ajax({type:"GET",url:"/loyalty/getpoint",cache:false,dataType:"json",success:function(c){if(c.ret==1){$("#checkout_point_div").show();var b=c.data;$("#cart_usablepoint").text(b)}}})}function getUsableCoupon(){var b=$("#islogin").val();if(b=="false"){return}var a=$("#cartlist_ul .sel").attr("storageid");$.ajax({type:"GET",url:"/loyalty/coupon?storageid="+a+"&time="+new Date(),cache:false,dataType:"json",success:function(g){if(g.ret==1&&g.data.length>0){$("#checkout_coupon_div").show();var h=g.data;$("#coupon_input_show").hide();var e="";for(var d=0;d<h.length;d++){var c=h[d].cash;if(c){var f=parseFloat(h[d].value);e+="<li code="+h[d].code+">"+(f<1?f*100+"%":(h[d].unit=="JPY"?parseInt(h[d].value):f.toFixed(2)))+" "+h[d].unit+"</li>"}else{e+="<li code="+h[d].code+">"+h[d].value+" "+h[d].unit+"</li>"}}$("#checkout_coupon_apply").css("display","inline-block");$("#checkout_coupon_insert").html(e);$("#checkout_coupon_insert li").click(function(){$(this).parents(".have_code_select").find(".current_list").hide();$("#checkout_coupon_code").text($(this).attr("code"))});$("#checkout_coupon_code").unbind().click(function(){$(this).parent().find(".current_list").toggle()})}}})}function undoPrefer(){$.ajax({type:"GET",url:"/loyalty/undoprefer?time="+new Date(),dataType:"json",success:function(a){if(a.result=="success"){location.reload()}}})}function undoPoint(){$.ajax({type:"GET",url:"/loyalty/undopoint?time="+new Date(),dataType:"json",success:function(a){if(a.result=="success"){location.reload()}}})}function getCurrentPrefer(){var a=$("#cartlist_ul .sel").attr("storageid");a=a||1;$.ajax({type:"GET",url:"/loyalty/allprefer",cache:false,async:false,dataType:"json",success:function(g){if(g.result=="success"){var h=g.data;var d=0;if(h.length>0){$(".have_code_input").show();$(".have_code p span").text("-")}for(var e=0;e<h.length;e++){var c=h[e];var f=$("#grandTotal").text();var b=c.discount;f=f.replace(/,/g,"");if(f.indexOf(".")==-1){f=parseInt(f);b=parseInt(b);d+=b;f=f+b;$("#grandTotal").text(f);$("#discount_total").text(d)}else{f=parseFloat(f);b=parseFloat(b);d+=b;f=f+b;f=Math.round(f*100)/100;$("#discount_total").text(toDecimal2(d));$("#grandTotal").text(toDecimal2(f))}if(c.type=="coupon"){$("#checkout_promo_div").hide();$("#checkout_coupon_div").show();$("#checkout_coupon_canel").show();$("#checkout_coupon_apply").hide();$("#checkout_coupon_code").text(c.code);$("#checkout_coupon_code").unbind()}else{if(c.type=="promo"){$("#checkout_coupon_div").hide();$("#checkout_promo_apply").hide();$("#checkout_promo_cancel").css("display","inline-block");$("#checkout_promo_input").val(c.code).attr("disabled","disabled")}else{if(c.type=="point"){$("#checkout_point_div").show();$("#checkout_point_apply").hide();$("#checkout_point_cancel").css("display","inline-block");$("#checkout_point_input").val(c.discount).attr("disabled","disabled");$("#checkout_point_div .points_num").hide()}}}}if($("#checkout_point_div").is(":hidden")){getUsablePoint()}if(!$("#checkout_promo_input").attr("disabled")&&$("#checkout_coupon_code").text()=="Coupon Code"){getUsableCoupon()}}else{$("#checkout_promo_input").attr("disabled",false);$("#checkout_point_input").attr("disabled",false);getUsablePoint();getUsableCoupon()}}})}function applyPromo(){var b=$("#checkout_promo_input").val().trim();if(!b){return}var a=$("#cartlist_ul .sel").attr("storageid");$.ajax({type:"GET",dataType:"json",data:{code:$("#checkout_promo_input").val()},url:"/loyalty/applypromo?storageid="+a+"&time="+new Date(),success:function(c){if(c.result=="success"){location.reload()}else{$("#checkout_promo_div .error_p").text(c.result).show()}}})}function applyCoupon(){var b=$("#checkout_coupon_code").text();if(!b){return}var a=$("#cartlist_ul .sel").attr("storageid");$.ajax({type:"GET",url:"/loyalty/applycoupon?storageid="+a+"&time="+new Date(),data:{code:b},success:function(c){if(c.result=="success"){window.location.reload()}else{$("#checkout_coupon_div .error_p").html(c.result).show()}}})}function applyPoint(){var b=$("#islogin").val();if(b=="false"){$(".blockPopup_box").show();return}var c=$("#checkout_point_input").val();if(!(c&&c>0)){return}var a=$("#cartlist_ul .sel").attr("storageid");$.ajax({type:"GET",url:"/loyalty/applypoint?storageid="+a+"&time="+new Date(),dataType:"json",data:{point:c},success:function(e){if(e.result=="success"){window.location.reload()}else{var d=$("#checkout_point_div .error_p");d.text(e.result);d.show()}}})}$(function(){getCurrentPrefer()});