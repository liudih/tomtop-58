$(function(){$("#ns_loading_box").show();$(".nw_btn_paypal").click(function(){var m=$(this).attr("url");skippay(m,false)});$(".nw_btn_place").click(function(){var m=$(this).attr("url");skippay(m,true)});var l=$("#cartsize").val();var b=$("#latesize").val();if(l!=""&&parseInt(l)==0&&b!=""&&parseInt(b)>0){$(".warehouse_later_list .myshop_wares").show()}var k=$("#thestorageid").val();var i=false;if(k!=null&&k!=""&&!isNaN(k)){var f=parseInt(k);$("#cartlist_ul .warehouse_sel").each(function(n,o){var m=parseInt($(this).attr("storageid"));if(m==f){$(this).addClass("sel");setStorageid(m);i=true;return false}})}if(i==false){var c=$("#cartlist_ul .storage_products>.sel");if(c.length==0){$("#cartlist_ul li:eq(0)").find(".warehouse_sel").addClass("sel");var j=$("#cartlist_ul li:eq(0)").find(".warehouse_sel").attr("storageid");if(j==null||j==undefined||isNaN(j)){j=""}setStorageid(j)}else{var e=c.attr("storageid");setStorageid(e)}}var h=false;$("#cartlist_ul .storage_products>.sel").parent().find(".csku").each(function(m,n){if($(this).html()=="X01"){h=true;return false}});if(!h){$(".nw_drop_order").removeClass("sel")}else{$(".nw_drop_order").addClass("sel")}var a=$("#cartlist_ul .storage_products>.sel").parent();if(a!=null){getStorageTotal(a)}var g=$("#currencycode").val();if(g=="JPY"){var d=parseInt($("#discount_total").html());$("#discount_total").html(d)}setTimeout(function(){$("#ns_loading_box").hide()},500)});$("#cartlist_ul .warehouse_sel").click(function(){if($(this).hasClass("sel")){return}$("#ns_loading_box").show();var a=$(this).parent();var b=false;a.find(".csku").each(function(c,d){if($(this).html()=="X01"){b=true;return false}});if(!b){$(".nw_drop_order").removeClass("sel")}else{$(".nw_drop_order").addClass("sel")}updatePrice($(this));setTimeout(function(){$("#ns_loading_box").hide()},500)});function updatePrice(b){var c=b.parent();getStorageTotal(c);var a=b.filter(".warehouse_sel").attr("storageid");if(a){setStorageid(a)}$("#checkout_coupon_div").hide();$("#checkout_coupon_canel").hide();$("#checkout_coupon_apply").show();$("#checkout_coupon_code").html("Coupon Code");$("#checkout_promo_div").show();$("#checkout_promo_apply").show();$("#checkout_promo_cancel").hide();$("#checkout_promo_input").val("").removeAttr("disabled");$("#checkout_point_div").hide();$("#checkout_point_apply").show();$("#checkout_point_cancel").hide();$("#checkout_point_input").val("").removeAttr("disabled");$("#checkout_point_div .points_num").show();getCurrentPrefer()}function getStorageTotal(d){var c=0;d.find(".theprice").each(function(f,h){var g=$(this).val();g=g.replace(/[,]/g,"");c+=parseFloat(g)});var a=$("#currencycode").val();var b="JPY"==a;c=b?Math.floor(c):c.toFixed(2);var e=b?"0":"0.00";$("#subtotal").html(c);$("#grandTotal").html(c);$("#discount_total").html(e)}function reloadPage(){location.reload()}function additem(e){var c=[];var d={};d.clistingid=e;d.qty=1;d.storageid=1;c[0]=d;var a=$.toJSON(c);var b="/savecartitem";$.ajax({url:b,type:"POST",dataType:"json",data:{data:a},success:function(f){if(f.result=="success"){reloadPage()}else{if(f.result=="no-enough"){pophtml("Error","Out of stock!")}else{if(f.result=="sold-out"){pophtml("Error","Sold out!")}else{pophtml("Error","add error!")}}}}})}function delitem(d){var f=$(d).closest(".itemline");var b=f.find(".storageid:eq(0)").val();b=isNaN(b)?1:b;var e=[];f.find(".clistingid").each(function(g,j){var h={};h.clistingid=$(this).val();h.storageid=b;e[e.length]=h});var a=$.toJSON(e);var c="/delcartitem";$.ajax({url:c,type:"POST",dataType:"json",data:{data:a},success:function(g){if(g.result=="success"){reloadPage()}}})}function popDel(a){$(a).next().toggle()}function hideDel(a){$(a).closest(".toggleDel").hide()}function updateItem(b,c){var a=1;if(b=="sub"){a=parseInt($(c).next().find("input:eq(0)").val());if(a>1){a=a-1}else{return}$(c).next().find("input:eq(0)").val(a)}else{if(b=="add"){a=parseInt($(c).prev().find("input:eq(0)").val());if(a<999){a=a+1}else{return}$(c).prev().find("input:eq(0)").val(a)}}updateQtyCommon(c,a)}$(".input_num").blur(function(){var b=this.value;var a=$(this).closest(".itemline").find(".iqty:eq(0)").val();if(isNaN(b)||b<1||b>999){b=1}if(parseInt(b)==parseInt(a)){this.value=b;return}this.value=b;updateQtyCommon(this,b)});$(".input_num").keydown(function(a){if(a.keyCode==13){var b=this.value;if(isNaN(b)||b<1||b>999){b=1}this.value=b;updateQtyCommon(this,b)}});function updateQtyCommon(d,c){$("#ns_loading_box").show();var f=$(d).closest(".itemline");var b=f.find(".storageid:eq(0)").val();b=isNaN(b)?1:b;var e=[];f.find(".clistingid").each(function(g,j){var h={};h.clistingid=$(this).val();h.storageid=b;h.qty=c;e[e.length]=h});var a=$.toJSON(e);$.ajax({url:"/updatecartitem",type:"POST",dataType:"json",data:{data:a},success:function(l){if(l.result=="success"){var j=l.cartItem;if(j){var m=j.price.unitBasePrice;var k=j.price.unitPrice;var n=j.price.spec.qty;var g=(m-k)*n;var h=$("#currencycode").val();f.find(".showTotal:eq(0)").html(j.price.priceStr);if(h!="JPY"){f.find(".theprice").val(j.price.price.toFixed(2));f.find(".showDiscountTotal:eq(0)").html(g.toFixed(2))}else{f.find(".theprice").val(Math.floor(j.price.price));f.find(".showDiscountTotal:eq(0)").html(Math.floor(g))}var i=f.closest(".storage_products").find(".warehouse_sel:eq(0)");if(i.hasClass("sel")){updatePrice(i)}}}else{if(l.result=="no-enough"){pophtml("Error","Out of stock!");resetNum(d)}else{pophtml("Error","update error!");resetNum(d)}}setTimeout(function(){$("#ns_loading_box").hide()},500)},error:function(g){setTimeout(function(){$("#ns_loading_box").hide()},500)}})}function resetNum(b){var c=$(b).closest(".itemline");var a=c.find(".iqty:eq(0)").val();c.find(".input_num:eq(0)").val(a)}function addLaterCart(e){var g=$(e).closest(".itemline");var b=g.find(".storageid:eq(0)").val();var d=g.find(".iqty:eq(0)").val();var f=[];g.find(".clistingid").each(function(h,k){var j={};j.clistingid=$(this).val();j.storageid=b;j.qty=d;f[f.length]=j});var a=$.toJSON(f);var c="/savelatercartitem";$.ajax({url:c,type:"POST",dataType:"json",data:{data:a},success:function(h){if(h.result=="success"){reloadPage()}}})}function moveToCart(e){var g=$(e).closest(".itemline");var b=g.find(".storageid:eq(0)").val();var d=g.find(".iqty:eq(0)").val();var f=[];g.find(".clistingid").each(function(h,k){var j={};j.clistingid=$(this).val();j.storageid=b;j.qty=d;f[f.length]=j});var a=$.toJSON(f);var c="/latertocart";$.ajax({url:c,type:"POST",dataType:"json",data:{data:a},success:function(h){if(h.result=="success"){reloadPage()}else{if(h.result=="no-enough"){pophtml("Error","Out of stock!")}else{if(h.result=="sold-out"){pophtml("Error","Sold out!")}else{pophtml("Error","add error!")}}}}})}function delLateritem(e){var g=$(e).closest(".itemline");var b=g.find(".storageid:eq(0)").val();var d=g.find(".iqty:eq(0)").val();var f=[];g.find(".clistingid").each(function(h,k){var j={};j.clistingid=$(this).val();j.storageid=b;j.qty=d;f[f.length]=j});var a=$.toJSON(f);var c="/dellatercart";$.ajax({url:c,type:"POST",dataType:"json",data:{data:a},success:function(h){if(h.result=="success"){reloadPage()}}})}function addcollect(c,d){var f=$("#islogin").val();if(f=="false"){$(".blockPopup_box").show();return}var b=$("#theemail").val();var e={};e.listingId=c;e.email=b;var a=$.toJSON(e);$.ajax({url:"/collect",type:"POST",dataType:"json",data:a,success:function(g){if(g.result=="nologin"){$(".blockPopup_box").show();return}if(g.result=="success"){pophtml("Success","Success!")}else{pophtml("Error",g.result)}}})}function skippay(d,f){var b=$("#cartlist_ul .sel").attr("storageid");if(b==null||b==undefined||b==""){pophtml("Error","Please choose the warehouse!");return}d+="?storageid="+b;var h=0;if(f){h=1;var g=$("#islogin").val();if(g=="false"){$("#loginPopWarp").show();return}}var a=parseFloat($("#grandTotal").html());if(a<=0){pophtml("Error","Total can not be zero!");return}var e="";var b=$("#cartlist_ul .sel").attr("storageid");var c=$("#cartlist_ul .storage_products>.sel").parent();c.find(".itemline").each(function(k,l){var n=$(l);var m=n.find(".clistingid:eq(0)").val();var j=n.find(".iqty:eq(0)").val();e+=m+":"+j+","});$.ajax({url:"/checkstatus",type:"GET",dataType:"json",data:{islogin:h,storageid:b,listingids:e},success:function(i){if(i.result=="success"){$("#ns_loading_box").show();window.location.href=d}else{if(i.result=="no-login"){$("#loginPopWarp").show()}else{if(i.result=="no-qty"){pophtml("Error","quantity shortage")}}}}})}function pophtml(d,c){var a=$("#errorBox");if(a.length==0){var b=[];b[b.length]='<div style="display: block" class="blockPopup_box" id="errorBox" >';b[b.length]='<div class="ns_pop_box"><div class="btn_pop_close" id="popClose" ></div>';b[b.length]='<div class="pop_title"><h3>'+d+"</h3></div>";b[b.length]='<div class="pop_con"><p id="errorBoxTxt">'+c+"</p></div>";b[b.length]='<div class="pop_input_box">';b[b.length]='<input type="button" class="pop_input_confirm" value="OK" id="errorBoxOkBtn"/></div></div>';b[b.length]='<div class="blockPopup_black"></div></div>';$("body").append(b.join(""));$("#errorBoxOkBtn,#popClose").click(function(){$("#errorBox").remove()})}$("#errorBox").show();$("#errorBoxTxt").text((c||""))}function confirmHtml(e,d,a){var b=$("#errorBox");if(b.length==0){var c=[];c[c.length]='<div style="display: block" class="blockPopup_box" id="errorBox" >';c[c.length]='<div class="ns_pop_box"><div class="btn_pop_close" id="popClose"></div>';c[c.length]='<div class="pop_title"><h3>'+e+"</h3></div>";c[c.length]='<div class="pop_con"><p id="errorBoxTxt">'+d+"</p></div>";c[c.length]='<div class="pop_input_box">';c[c.length]='<input type="button" class="pop_input_close" id="errorBoxOkBtn" value="CANCEL" />';c[c.length]='<input type="button" class="pop_input_confirm" value="OK" id="confirmBtn" /></div></div>';c[c.length]='<div class="blockPopup_black"></div></div>';$("body").append(c.join(""));$("#errorBoxOkBtn,#popClose").click(function(){$("#errorBox").remove()});$("#confirmBtn").click(function(){a()})}$("#errorBox").show();$("#errorBoxTxt").text((d||""))}function addDropshipping(e){var i=$(e);var f=i.hasClass("sel");var j=$("#cartlist_ul .storage_products>.sel");var c=j.attr("storageid");c=c==null?1:c;var g="";j.parent().find(".csku").each(function(l,n){if($(this).html()=="X01"){var m=$(this).closest(".itemline");g=m.find(".clistingid:eq(0)").val();return false}});if(f&&g!=""){var d=c;var h=[];var b={};b.clistingid=g;b.storageid=d;h[h.length]=b;var k=$.toJSON(h);var a="/delcartitem";$.ajax({url:a,type:"POST",dataType:"json",contentType:"application/json",data:k,success:function(l){if(l.result=="success"){i.removeClass("sel");reloadPage()}}})}else{if(!f){var a="/adddropshipping";$.ajax({url:a,type:"GET",dataType:"json",data:{storageid:c},async:true,success:function(l){if(l.result=="success"){i.addClass("sel");reloadPage()}},complete:function(){}})}}}function setStorageid(a){setCookie("storageid","",-1);$.ajax({url:"/setstorageid",type:"GET",dataType:"json",async:false,data:{storageid:a},success:function(b){}})}function addCookie(c,d,g,e){var c=escape(c);var d=escape(d);var a=new Date();a.setTime(a.getTime()+g*3600000*24);e=e==""?"":";path="+e;var f=(typeof g)=="string"?"":";expires="+a.toUTCString();var b=$("#hostname").val()||"tomtop";document.cookie=c+"="+d+f+e+";domain=."+b+".com"}function setCookie(b,f,c){var e=new Date();e.setTime(e.getTime()+(c*24*60*60*1000));var a="expires="+e.toUTCString();document.cookie=b+"="+f+"; "+a+";domain=."+hostname+".com"}function removeLoyaltyCookie(){setCookie("loyalty","",-1);setCookie("point","",-1)};